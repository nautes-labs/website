<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>主体流程 | Nautes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Nautes website and documentation repo.">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.1a8e0fbc.css" as="style"><link rel="preload" href="/assets/js/app.24c263c8.js" as="script"><link rel="preload" href="/assets/js/2.15dacd45.js" as="script"><link rel="preload" href="/assets/js/8.94c92edf.js" as="script"><link rel="prefetch" href="/assets/js/10.ed56397e.js"><link rel="prefetch" href="/assets/js/11.310e9cbc.js"><link rel="prefetch" href="/assets/js/12.d1d47a5a.js"><link rel="prefetch" href="/assets/js/13.b878b964.js"><link rel="prefetch" href="/assets/js/14.c0e05ef3.js"><link rel="prefetch" href="/assets/js/15.f6443463.js"><link rel="prefetch" href="/assets/js/16.0d760b70.js"><link rel="prefetch" href="/assets/js/17.e4a0ab1e.js"><link rel="prefetch" href="/assets/js/18.b8b968f6.js"><link rel="prefetch" href="/assets/js/19.52c3d84f.js"><link rel="prefetch" href="/assets/js/20.82405c47.js"><link rel="prefetch" href="/assets/js/21.f3415b9b.js"><link rel="prefetch" href="/assets/js/22.5be49e48.js"><link rel="prefetch" href="/assets/js/23.046801f2.js"><link rel="prefetch" href="/assets/js/24.0d8d4060.js"><link rel="prefetch" href="/assets/js/25.24e35b19.js"><link rel="prefetch" href="/assets/js/26.0ab5b4ef.js"><link rel="prefetch" href="/assets/js/27.6ac7d2d4.js"><link rel="prefetch" href="/assets/js/28.6d0d68e4.js"><link rel="prefetch" href="/assets/js/29.38215f72.js"><link rel="prefetch" href="/assets/js/3.d0b0a73a.js"><link rel="prefetch" href="/assets/js/30.8fb569dd.js"><link rel="prefetch" href="/assets/js/31.73354d33.js"><link rel="prefetch" href="/assets/js/32.061ca11d.js"><link rel="prefetch" href="/assets/js/33.e0cae842.js"><link rel="prefetch" href="/assets/js/34.b7b2af2a.js"><link rel="prefetch" href="/assets/js/35.c74dff73.js"><link rel="prefetch" href="/assets/js/36.630e9a91.js"><link rel="prefetch" href="/assets/js/37.ad8550d3.js"><link rel="prefetch" href="/assets/js/38.f265216b.js"><link rel="prefetch" href="/assets/js/39.c4eacf80.js"><link rel="prefetch" href="/assets/js/4.97fb3c3f.js"><link rel="prefetch" href="/assets/js/40.81a59670.js"><link rel="prefetch" href="/assets/js/41.b2efffaf.js"><link rel="prefetch" href="/assets/js/42.30596d7b.js"><link rel="prefetch" href="/assets/js/43.fd802c73.js"><link rel="prefetch" href="/assets/js/44.0e40f726.js"><link rel="prefetch" href="/assets/js/45.5817415a.js"><link rel="prefetch" href="/assets/js/46.3a809546.js"><link rel="prefetch" href="/assets/js/47.db785190.js"><link rel="prefetch" href="/assets/js/48.cb89b706.js"><link rel="prefetch" href="/assets/js/49.4bc34cfc.js"><link rel="prefetch" href="/assets/js/5.ebb2032f.js"><link rel="prefetch" href="/assets/js/50.59df7656.js"><link rel="prefetch" href="/assets/js/51.410b4e1f.js"><link rel="prefetch" href="/assets/js/52.a14bbd4f.js"><link rel="prefetch" href="/assets/js/53.ae266623.js"><link rel="prefetch" href="/assets/js/54.050783ad.js"><link rel="prefetch" href="/assets/js/55.b10279c8.js"><link rel="prefetch" href="/assets/js/56.345f7528.js"><link rel="prefetch" href="/assets/js/57.2e2e5d9b.js"><link rel="prefetch" href="/assets/js/58.503c303a.js"><link rel="prefetch" href="/assets/js/59.fc7a2cf6.js"><link rel="prefetch" href="/assets/js/6.aaacec56.js"><link rel="prefetch" href="/assets/js/60.8917989a.js"><link rel="prefetch" href="/assets/js/61.51e2336d.js"><link rel="prefetch" href="/assets/js/62.34c213c5.js"><link rel="prefetch" href="/assets/js/63.dab68e36.js"><link rel="prefetch" href="/assets/js/64.edcd75c2.js"><link rel="prefetch" href="/assets/js/65.04c1b803.js"><link rel="prefetch" href="/assets/js/66.7fcf6464.js"><link rel="prefetch" href="/assets/js/67.4aa748b0.js"><link rel="prefetch" href="/assets/js/68.907dbde6.js"><link rel="prefetch" href="/assets/js/69.665c1c2a.js"><link rel="prefetch" href="/assets/js/7.e5720606.js"><link rel="prefetch" href="/assets/js/70.cbe3f912.js"><link rel="prefetch" href="/assets/js/71.66550a64.js"><link rel="prefetch" href="/assets/js/72.59be5629.js"><link rel="prefetch" href="/assets/js/73.6a229f04.js"><link rel="prefetch" href="/assets/js/74.cb88da97.js"><link rel="prefetch" href="/assets/js/75.2ccc7f52.js"><link rel="prefetch" href="/assets/js/76.23fb8877.js"><link rel="prefetch" href="/assets/js/77.12aeb765.js"><link rel="prefetch" href="/assets/js/78.e43edefd.js"><link rel="prefetch" href="/assets/js/79.cd04a7eb.js"><link rel="prefetch" href="/assets/js/80.47007792.js"><link rel="prefetch" href="/assets/js/81.a09125a2.js"><link rel="prefetch" href="/assets/js/82.d195ea09.js"><link rel="prefetch" href="/assets/js/83.64433d08.js"><link rel="prefetch" href="/assets/js/84.36f7be72.js"><link rel="prefetch" href="/assets/js/9.fef3ad8f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.1a8e0fbc.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.png" alt="Nautes" class="logo"> <span class="site-name can-hide">Nautes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="https://github.com/nautes-labs/nautes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/guide/" class="nav-link router-link-active">
  文档
</a></div><div class="nav-item"><a href="/api/" class="nav-link">
  API
</a></div><div class="nav-item"><a href="https://github.com/nautes-labs/nautes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>快速入门</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/user-guide/introduction.html" class="sidebar-link">概述</a></li><li><a href="/guide/user-guide/installation.html" class="sidebar-link">安装</a></li><li><a href="/guide/user-guide/deploy-an-application.html" class="sidebar-link">部署一个应用</a></li><li><a href="/guide/user-guide/clean-environment.html" class="sidebar-link">清理环境</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>用户指南</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/guide/user-guide/main-process.html" aria-current="page" class="active sidebar-link">主体流程</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/guide/user-guide/main-process.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/guide/user-guide/main-process.html#注册运行时集群" class="sidebar-link">注册运行时集群</a></li><li class="sidebar-sub-header"><a href="/guide/user-guide/main-process.html#准备运行环境" class="sidebar-link">准备运行环境</a></li><li class="sidebar-sub-header"><a href="/guide/user-guide/main-process.html#部署" class="sidebar-link">部署</a></li><li class="sidebar-sub-header"><a href="/guide/user-guide/main-process.html#查看部署结果" class="sidebar-link">查看部署结果</a></li></ul></li><li><a href="/guide/user-guide/cluster.html" class="sidebar-link">注册运行时集群</a></li><li><a href="/guide/user-guide/product.html" class="sidebar-link">维护产品</a></li><li><a href="/guide/user-guide/project.html" class="sidebar-link">维护项目</a></li><li><a href="/guide/user-guide/code-repo.html" class="sidebar-link">维护代码库</a></li><li><a href="/guide/user-guide/environment.html" class="sidebar-link">维护环境</a></li><li><a href="/guide/user-guide/deployment-runtime.html" class="sidebar-link">维护部署运行时</a></li><li><a href="/guide/user-guide/deployment-results.html" class="sidebar-link">查看部署结果</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="主体流程"><a href="#主体流程" class="header-anchor">#</a> 主体流程</h1> <p>下文将描述部署一个应用的主体流程。包括以下步骤:<br> <a href="#%E5%AE%89%E8%A3%85">安装</a><br> <a href="#%E6%B3%A8%E5%86%8C%E8%BF%90%E8%A1%8C%E6%97%B6%E9%9B%86%E7%BE%A4">注册运行时集群</a><br> <a href="#%E5%87%86%E5%A4%87%E8%BF%90%E8%A1%8C%E7%8E%AF%E5%A2%83">准备运行环境</a><br> <a href="#%E9%83%A8%E7%BD%B2">部署</a><br> <a href="#%E6%9F%A5%E7%9C%8B%E9%83%A8%E7%BD%B2%E7%BB%93%E6%9E%9C">查看部署结果</a></p> <p>主体流程成功执行之后的效果，如下图所示：
<img src="/assets/img/user-guide-overview-1.1cfbb4e9.png" alt="directive syntax graph"></p> <p>在 Nautes 中，租户管理集群和部署运行时集群是必不可少的组成部分。每个租户只有一个租户管理集群，负责初始化该租户的所有部署运行时集群，并协调各种组件，以向部署运行时集群实施自动化部署。每个租户只有一个存储在 GitLab 中的租户配置库，租户管理集群通过监听租户配置库，向其自动更新相关组件和资源。<br>
每个租户可以拥有多个部署运行时集群，这些部署运行时集群是承载IT系统运行时环境的真正载体，可以是虚拟集群或者物理集群。</p> <p>根据IT系统的生命周期，不同阶段需要有配套的运行时环境，用于验证或使用IT系统的功能和非功能特性。通常根据生命周期的不同阶段划分为不同类型的环境，例如开发、测试、预生产和生产环境，这里的环境是一个逻辑概念，作为IT系统部署运行时的管理单元。<br>
环境需要在部署运行时集群上运行，因此必须将环境与部署运行时集群相关联，以便IT系统部署到正确的运行时环境中。</p> <p>在Nautes中，对于微服务架构的IT系统，“产品”表示一个IT系统，“项目”表示一个微服务。因此，一个产品包含多个项目，每个项目有独立的代码库。<br>
产品进行到一定阶段时需要验证或使用其特性，通常会根据部署配置向环境关联的部署运行时集群进行部署，以生成部署运行时环境。每个产品可以包含多个部署运行时环境，例如，使用相同部署配置在不同集群所创建出来的功能测试和客户演示环境。同时，在相同集群上也可以承载多个产品的部署运行时环境。</p> <p>Nautes 通过 Kubernetes 资源文件来定义环境、项目、代码库和部署运行时，并将这些资源文件存储到产品的 GitLab 代码库，资源文件的集合称为“产品配置清单”。Nautes 监听产品配置清单向部署运行时集群实施自动部署，创建或更新产品的部署运行时环境。</p> <p>当用户向部署运行时集群监听的 GitLab 代码库提交 Kubernetes 资源清单，产品的部署运行时环境监听 Kubernetes 资源清单并向部署运行时集群实施自动部署，直到部署运行时集群中的实际状态与 GitLab 代码库中的预期状态一致为止。</p> <p>为了保护敏感信息不被泄露，Nautes 中的敏感信息均通过 Vault 存取。</p> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <p>详情参考 <a href="/guide/user-guide/installation.html">安装</a>。</p> <h2 id="注册运行时集群"><a href="#注册运行时集群" class="header-anchor">#</a> 注册运行时集群</h2> <p>支持 <a href="/guide/user-guide/deploy-an-application.html#注册运行时集群">命令行</a> 和 <a href="/guide/user-guide/cluster.html">API</a> 两种方式注册运行时集群。</p> <h2 id="准备运行环境"><a href="#准备运行环境" class="header-anchor">#</a> 准备运行环境</h2> <p>提交产品配置清单支持 <a href="/guide/user-guide/deploy-an-application.html#准备运行环境">命令行</a> 和 API 两种方式。使用 API 接口的详细参见 <a href="/guide/user-guide/product.html">维护产品</a>、<a href="/guide/user-guide/project.html">维护项目</a>、<a href="/guide/user-guide/code-repo.html">维护代码库</a>、<a href="/guide/user-guide/environment.html">维护环境</a>、<a href="/guide/user-guide/deployment-runtime.html">维护部署运行时</a> 章节。<br>
提交产品配置清单有先后顺序。正向新增的顺序是：创建产品、创建环境、创建项目、创建代码库、创建部署运行时。反向销毁的顺序是：删除部署运行时、删除代码库、删除项目、删除环境、删除产品。</p> <p>产品创建成功后，将在 GitLab 中创建与产品同名的 group，并在这个 group 中创建名称为 default.project 的代码库，用于存储该产品的配置清单，包括环境、项目、代码库和部署运行时的资源文件。每个 group 有且只有一个 default.project 代码库。</p> <p>产品配置清单创建成功后，根据产品配置清单将在部署运行时集群中自动安装相关资源，使得部署运行时集群具备监听产品的 GitLab 代码库、并向该集群自动部署的能力。</p> <h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <p>使用 Git CLI 向产品的 GitLab 代码库提交 Kubernetes 资源清单，例如：deployment、service 等资源。提交成功后，将向指定的部署运行时集群部署产品。详情参考 <a href="/guide/user-guide/deploy-an-application.html#部署">部署</a>。</p> <h2 id="查看部署结果"><a href="#查看部署结果" class="header-anchor">#</a> 查看部署结果</h2> <p>部署成功后，可以通过 ArgoCD 控制台或者 kubectl 命令行查看产品的部署结果，并且只能查看和管理被授权产品的相关资源。详细参考 <a href="/guide/user-guide/deployment-results.html">查看部署结果</a>。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/guide/user-guide/clean-environment.html" class="prev">
        清理环境
      </a></span> <span class="next"><a href="/guide/user-guide/cluster.html">
        注册运行时集群
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.24c263c8.js" defer></script><script src="/assets/js/2.15dacd45.js" defer></script><script src="/assets/js/8.94c92edf.js" defer></script>
  </body>
</html>
