<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Run a Pipeline | Nautes</title>
    <meta name="generator" content="VuePress 1.9.9">
    
    <meta name="description" content="Kubernetes-native all-in-one Internal Developer Platform">
    <meta name="theme-color" content="#3eaf7c">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    
    <link rel="preload" href="/assets/css/0.styles.c2c28341.css" as="style"><link rel="preload" href="/assets/js/app.6f7c6124.js" as="script"><link rel="preload" href="/assets/js/2.5cda13a8.js" as="script"><link rel="preload" href="/assets/js/46.df43c17b.js" as="script"><link rel="prefetch" href="/assets/js/10.98567a6f.js"><link rel="prefetch" href="/assets/js/11.28e80cdf.js"><link rel="prefetch" href="/assets/js/12.debc7c72.js"><link rel="prefetch" href="/assets/js/13.dee35591.js"><link rel="prefetch" href="/assets/js/14.b13bc8ba.js"><link rel="prefetch" href="/assets/js/15.e37f3143.js"><link rel="prefetch" href="/assets/js/16.69ba4994.js"><link rel="prefetch" href="/assets/js/17.e9bfa8b1.js"><link rel="prefetch" href="/assets/js/18.9fd6e6d1.js"><link rel="prefetch" href="/assets/js/19.b4c42f8a.js"><link rel="prefetch" href="/assets/js/20.fecb0727.js"><link rel="prefetch" href="/assets/js/21.b2de65cb.js"><link rel="prefetch" href="/assets/js/22.305f3553.js"><link rel="prefetch" href="/assets/js/23.4e425205.js"><link rel="prefetch" href="/assets/js/24.6ac4a85f.js"><link rel="prefetch" href="/assets/js/25.76d4b3d3.js"><link rel="prefetch" href="/assets/js/26.f374973e.js"><link rel="prefetch" href="/assets/js/27.fb6cb366.js"><link rel="prefetch" href="/assets/js/28.80da3970.js"><link rel="prefetch" href="/assets/js/29.26e3bf7f.js"><link rel="prefetch" href="/assets/js/3.7b659903.js"><link rel="prefetch" href="/assets/js/30.cfbfb3b3.js"><link rel="prefetch" href="/assets/js/31.175771e8.js"><link rel="prefetch" href="/assets/js/32.29c08ecc.js"><link rel="prefetch" href="/assets/js/33.3c80d25d.js"><link rel="prefetch" href="/assets/js/34.5e76fb88.js"><link rel="prefetch" href="/assets/js/35.dafaf7ff.js"><link rel="prefetch" href="/assets/js/36.a4001f90.js"><link rel="prefetch" href="/assets/js/37.b3d0d6d7.js"><link rel="prefetch" href="/assets/js/38.d3f3032c.js"><link rel="prefetch" href="/assets/js/39.a969a4ab.js"><link rel="prefetch" href="/assets/js/4.f644a4d9.js"><link rel="prefetch" href="/assets/js/40.4268c17b.js"><link rel="prefetch" href="/assets/js/41.3e93d60b.js"><link rel="prefetch" href="/assets/js/42.aa08e4fb.js"><link rel="prefetch" href="/assets/js/43.fe91abb7.js"><link rel="prefetch" href="/assets/js/44.7716dc50.js"><link rel="prefetch" href="/assets/js/45.d9fa2d53.js"><link rel="prefetch" href="/assets/js/47.347728e7.js"><link rel="prefetch" href="/assets/js/48.56d91caa.js"><link rel="prefetch" href="/assets/js/49.3eba754b.js"><link rel="prefetch" href="/assets/js/5.d7f38eb0.js"><link rel="prefetch" href="/assets/js/50.4ec99ffd.js"><link rel="prefetch" href="/assets/js/51.710e12d8.js"><link rel="prefetch" href="/assets/js/52.61d6d201.js"><link rel="prefetch" href="/assets/js/53.061332df.js"><link rel="prefetch" href="/assets/js/54.9024bf86.js"><link rel="prefetch" href="/assets/js/55.63f25d13.js"><link rel="prefetch" href="/assets/js/56.706aba7c.js"><link rel="prefetch" href="/assets/js/57.34244155.js"><link rel="prefetch" href="/assets/js/58.4ec39c0d.js"><link rel="prefetch" href="/assets/js/59.15f47839.js"><link rel="prefetch" href="/assets/js/6.08b03b29.js"><link rel="prefetch" href="/assets/js/7.57051b0f.js"><link rel="prefetch" href="/assets/js/8.a470f3fb.js"><link rel="prefetch" href="/assets/js/9.6b27c08a.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c2c28341.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/en/" class="home-link router-link-active"><!----> <span class="site-name">Nautes</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/en/guide/user-guide/introduction.html" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/api/introduction.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="https://github.com/nautes-labs/nautes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/guide/user-guide/run-a-pipeline.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-guide/run-a-pipeline.html" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/en/guide/user-guide/introduction.html" class="nav-link">
  Document
</a></div><div class="nav-item"><a href="/en/api/introduction.html" class="nav-link">
  API
</a></div><div class="nav-item"><a href="https://github.com/nautes-labs/nautes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/en/guide/user-guide/run-a-pipeline.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/guide/user-guide/run-a-pipeline.html" class="nav-link">
  中文
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Getting Started</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/guide/user-guide/introduction.html" class="sidebar-link">Overview</a></li><li><a href="/en/guide/user-guide/installation.html" class="sidebar-link">Installation</a></li><li><a href="/en/guide/user-guide/run-a-pipeline.html" aria-current="page" class="active sidebar-link">Run a Pipeline</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#installation" class="sidebar-link">Installation</a></li><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#register-runtime-cluster" class="sidebar-link">Register Runtime Cluster</a></li><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#initialize-a-product" class="sidebar-link">Initialize a Product</a></li><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#run-a-pipeline-2" class="sidebar-link">Run a Pipeline</a></li><li class="sidebar-sub-header"><a href="/en/guide/user-guide/run-a-pipeline.html#view-pipeline-results" class="sidebar-link">View Pipeline Results</a></li></ul></li><li><a href="/en/guide/user-guide/deploy-an-application.html" class="sidebar-link">Deploy an Application</a></li><li><a href="/en/guide/user-guide/clean-environment.html" class="sidebar-link">Clean Up the Environment</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>User Guide</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/en/guide/user-guide/main-process.html" class="sidebar-link">Main Process</a></li><li><a href="/en/guide/user-guide/cluster.html" class="sidebar-link">Register Runtime Cluster</a></li><li><a href="/en/guide/user-guide/product.html" class="sidebar-link">Maintain Product</a></li><li><a href="/en/guide/user-guide/project.html" class="sidebar-link">Maintain Project</a></li><li><a href="/en/guide/user-guide/code-repo.html" class="sidebar-link">Maintain Code Repository</a></li><li><a href="/en/guide/user-guide/environment.html" class="sidebar-link">Maintain Environment</a></li><li><a href="/en/guide/user-guide/deployment-runtime.html" class="sidebar-link">Maintain Deployment-Runtime</a></li><li><a href="/en/guide/user-guide/deployment-results.html" class="sidebar-link">View Pipeline and Deployment Results</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="run-a-pipeline"><a href="#run-a-pipeline" class="header-anchor">#</a> Run a Pipeline</h1> <p>This document describes the process of registering a new Kubernetes cluster to Nautes, on which a CI pipeline will be run.</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <h3 id="register-a-gitlab-account"><a href="#register-a-gitlab-account" class="header-anchor">#</a> Register a GitLab Account</h3> <p>After GitLab installation, you need to register an account and create a <a href="https://docs.gitlab.com/ee/user/profile/personal_access_tokens.html" target="_blank" rel="noopener noreferrer">personal access token<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> with the scopes: api, read_api, read_repository, and write_repository.</p> <p>The account needs to call the API for <a href="#register-runtime-cluster">managing the runtime clusters</a>, you need to add the account to the member list of the tenant configuration repository and ensure that the account can push code to the main branch.</p> <h3 id="import-certificates"><a href="#import-certificates" class="header-anchor">#</a> Import Certificates</h3> <p>If you want to access Nautes API Server using the HTTPS protocol, please download the ca.crt certificate from <a href="/en/guide/user-guide/installation.html#check-the-installation-results">the installation result</a>, and add ca.crt to the trusted certificate list of the server that executes the API.</p> <h3 id="prepare-a-server"><a href="#prepare-a-server" class="header-anchor">#</a> Prepare a Server</h3> <p>You need to prepare a server for installing the Kubernetes cluster. If you already have a Kubernetes cluster (with a public IP), you can skip this step.</p> <p>The following will describe how to prepare a server and install a K3s cluster using Alibaba Cloud as an example.</p> <p>Create an ECS cloud server. For more details, refer to <a href="https://help.aliyun.com/document_detail/25422.html" target="_blank" rel="noopener noreferrer">Elastic Compute Service (ECS)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. After the server is successfully installed, install K3s on the server using the following command:</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># Replace $PUBLIC_IP with the public IP of the server.</span>
<span class="token comment"># Replace $DEX_SERVER with the oauth_url located at /opt/nautes/out/service directory of the installation machine.</span>
<span class="token comment"># Download the ca.crt located at /opt/nautes/out/pki directory of the installation machine, and upload it to the /etc/ssl/certs/ directory of the server.</span>
<span class="token function">curl</span> <span class="token parameter variable">-sfL</span> https://get.k3s.io <span class="token operator">|</span> <span class="token assign-left variable">INSTALL_K3S_VERSION</span><span class="token operator">=</span>v1.21.14+k3s1 <span class="token assign-left variable">INSTALL_K3S_EXEC</span><span class="token operator">=</span><span class="token string">&quot;--tls-san <span class="token variable">$PUBLIC_IP</span>&quot;</span> <span class="token function">sh</span> <span class="token parameter variable">-s</span> - server <span class="token parameter variable">--disable</span> servicelb <span class="token parameter variable">--disable</span> traefik <span class="token parameter variable">--disable</span> metrics-server --kube-apiserver-arg<span class="token operator">=</span>oidc-issuer-url<span class="token operator">=</span><span class="token variable">$DEX_SERVER</span> --kube-apiserver-arg<span class="token operator">=</span>oidc-client-id<span class="token operator">=</span>nautes --kube-apiserver-arg<span class="token operator">=</span>oidc-ca-file<span class="token operator">=</span>/etc/ssl/certs/ca.crt --kube-apiserver-arg<span class="token operator">=</span>oidc-groups-claim<span class="token operator">=</span>groups <span class="token parameter variable">-p</span> <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube
/bin/cp <span class="token parameter variable">-f</span> /etc/rancher/k3s/k3s.yaml <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube/k3s-config
/bin/cp <span class="token parameter variable">-f</span> /etc/rancher/k3s/k3s.yaml <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube/config
<span class="token builtin class-name">export</span> <span class="token assign-left variable">KUBECONFIG</span><span class="token operator">=</span><span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube/config
</code></pre></div><p>After the K3s installation is complete, you need to add an inbound rule for port <code>6443</code>. For more information, refer to the <a href="https://www.alibabacloud.com/help/en/elastic-compute-service/latest/create-a-security-group-2" target="_blank" rel="noopener noreferrer">Security Group Rules<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="installation"><a href="#installation" class="header-anchor">#</a> Installation</h2> <p>Using Alibaba Cloud as an example, this section describes the process of deploying Nautes on a public cloud. For more information, refer to the <a href="/en/guide/user-guide/installation.html">Installation</a>.</p> <h2 id="register-runtime-cluster"><a href="#register-runtime-cluster" class="header-anchor">#</a> Register Runtime Cluster</h2> <p>Registering a runtime cluster involves adding a prepared Kubernetes cluster to the tenant management cluster and initializing its configuration through the tenant management cluster. After initialization, the cluster can host the runtime of applications.</p> <p>The supported cluster types include physical clusters and virtual clusters.</p> <p>When higher performance, isolation, and reliability are required for your runtime of applications, it is recommended to use a <a href="#register-physical-cluster">physical cluster</a>. For other environments such as development, testing, and trial environments, a <a href="#register-runtime-cluster">virtual cluster</a> can be used.</p> <h3 id="register-physical-cluster"><a href="#register-physical-cluster" class="header-anchor">#</a> Register Physical Cluster</h3> <p>Clone the command-line repository to your local machine.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/nautes-labs/cli.git
</code></pre></div><p>Replace the variables in the physical cluster property template located at the relative path <code>examples/demo-cluster-physical-worker-pipeline.yaml</code>, including <code>$suffix</code>, <code>$api-server</code>, <code>$cluster-ip</code> and <code>$kubeconfig</code>.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># View the kubeconfig for the physical cluster.</span>
<span class="token function">cat</span> <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube/config
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Physical cluster property template</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Cluster name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;physical-worker-$suffix&quot;</span>
  <span class="token comment"># Cluster API SERVER URL. Replace the variable with the address of the physical cluster.</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;$api-server&quot;</span>
  <span class="token comment"># Cluster kind. Currently only supports Kubernetes.</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token comment"># Cluster type: virtual or physical</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;physical&quot;</span>
  <span class="token comment"># Cluster usage: host or worker</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;worker&quot;</span>
  <span class="token comment"># Runtime type: pipeline runtime</span>
  <span class="token key atrule">workerType</span><span class="token punctuation">:</span> <span class="token string">&quot;pipeline&quot;</span>
  <span class="token comment"># Primary domain, replace $cluster-ip with the cluster IP.</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># Tekton domain. Replace $cluster-ip with the cluster IP.</span>
  <span class="token key atrule">tektonHost</span><span class="token punctuation">:</span> <span class="token string">&quot;tekton.physical-worker-$suffix.$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># ArgoCD domain. Replace $cluster-ip with the cluster IP.</span>
  <span class="token key atrule">argocdHost</span><span class="token punctuation">:</span> <span class="token string">&quot;argocd.physical-worker-$suffix.$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># Traefik configuration</span>
  <span class="token key atrule">traefik</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30080&quot;</span>
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30443&quot;</span>
  <span class="token comment"># Content of the kubeconfig file of the cluster: Replace the variable with the kubeconfig of the physical cluster.</span>
  <span class="token key atrule">kubeconfig</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    $kubeconfig</span>
</code></pre></div><p>The physical cluster property example after replacing the variables is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;physical-worker-aliyun&quot;</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;https://8.217.50.114:6443&quot;</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;physical&quot;</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;worker&quot;</span>
  <span class="token key atrule">workerType</span><span class="token punctuation">:</span> <span class="token string">&quot;pipeline&quot;</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">tektonHost</span><span class="token punctuation">:</span> <span class="token string">&quot;tekton.physical-worker-aliyun.8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">argocdHost</span><span class="token punctuation">:</span> <span class="token string">&quot;argocd.physical-worker-aliyun.8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">traefik</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30080&quot;</span>
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30443&quot;</span>
  <span class="token key atrule">kubeconfig</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    apiVersion: v1
    clusters:
    - cluster:
        certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT0RFeU9UQXdPVFV3SGhjTk1qTXdOREV5TURrd01UTTFXaGNOTXpNd05EQTVNRGt3TVRNMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT0RFeU9UQXdPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSMzRuTjVPWWhxb3MrekV1YXZsVDRleXE4ZFRVZ2pxcUdoN2Z6NkpMZEMKem1FN0cwZjE5K0hLcEw5cU1tSXVBaStRelBZZFNzWGJpR20rNjR0R0NuVkRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVUp0WVUxbkNvTXNNYWpVeUJGN3RVCndjZWJ6TW93Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9hR2pWNlRpK2o1Yy9kWlV5a1pERml0OU9DdkFmZjEKWjJSVUJ6TkJTOUlhQWlFQTB1bzM2YUVGRnkvdWQ0eHREZnNkWmhYWmZOaXQ3c2N4SXREa1k5STlQUkU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
        server: https://127.0.0.1:6443
      name: default
    contexts:
    - context:
        cluster: default
        user: default
      name: default
    current-context: default
    kind: Config
    preferences: {}
    users:
    - name: default
      user:
        client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJSjYyRGdFT3JiM3d3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOamd4TWprd01EazFNQjRYRFRJek1EUXhNakE1TURFek5Wb1hEVEkwTURReApNVEE1TURFek5Wb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJJNnlLRlBKNENmS25BUFkKQ0Q5ZFVtZlZ5ekR2aFpEQUdhU1lYODVoWWRYZ0NKdmxHRmlad3dGN2ExKzEzdlQ5ZjE2MUJwSGhKTm9mYi9oeAozUVo1MWs2alNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCVHhiVTM2eC9iMnl3WU14SmpuUjF5L2w2cHZCREFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQS9rZ3FCOGJLZnNLSGNmaDBUSFQ2bTZNLzdrMzlNWmFGYlVCaE9GTzVDSW9DSURiRWNaeUxkc055R3lVVQpSTDl5K0hHcVJ3b1FTWGhOa1NrQjhlbkpsQTEzCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyT0RFeU9UQXdPVFV3SGhjTk1qTXdOREV5TURrd01UTTFXaGNOTXpNd05EQTVNRGt3TVRNMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyT0RFeU9UQXdPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTbnNEVkxLTU4xTWl4cHAwclRMRTBOVGdjamFRWFhmUmZmOThiOTRqd1gKYjRPNVh1aCtFclZwZ3BjamxRYjVZKzM0T1NwaG03TnVXWlA2OHBkUWhMTW5vMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVThXMU4rc2YyOXNzR0RNU1k1MGRjCnY1ZXFid1F3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUtXSStXQ2wwRFlJME5oVDBzbDkwSVRHRW05V2EyaE0KQXV4UXkrcDVUcGpzQWlBdWxFd0NkK2lWYXNVY2VHa2I4WU81dlduQitaTVJmSU1rYWRHSGhpSmlrdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
        client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSU5ZZFVkaER2SlFXcVNSRzR0d3gzQ2I4amhnck1HZlVOMG1uajV5dTRWZ1RvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFanJJb1U4bmdKOHFjQTlnSVAxMVNaOVhMTU8rRmtNQVpwSmhmem1GaDFlQUltK1VZV0puRApBWHRyWDdYZTlQMS9YclVHa2VFazJoOXYrSEhkQm5uV1RnPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=</span>
</code></pre></div><p>Download the <a href="https://github.com/nautes-labs/cli/releases/tag/v0.3.0" target="_blank" rel="noopener noreferrer">command-line tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and run the following command to register the physical cluster.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># examples/demo-cluster-physical-worker-pipeline.yaml refers to the relative path of the template file in the command-line repository.</span>
<span class="token comment"># gitlab-access-token refers to the GitLab access token.</span>
<span class="token comment"># api-server-address refers to the access address of the Nautes API Server.</span>
nautes apply <span class="token parameter variable">-f</span> examples/demo-cluster-physical-worker-pipeline.yaml <span class="token parameter variable">-t</span> <span class="token variable">$gitlab</span>-access-token <span class="token parameter variable">-s</span> <span class="token variable">$api</span>-server-address
</code></pre></div><h3 id="register-virtual-cluster"><a href="#register-virtual-cluster" class="header-anchor">#</a> Register Virtual Cluster</h3> <p>When registering a virtual cluster as a runtime cluster, you need to first register the physical cluster as the host cluster, and then register the virtual cluster to the host cluster.</p> <p>Clone the command-line repository to your local machine.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/nautes-labs/cli.git
</code></pre></div><p>Replace the variables in the host cluster property template located at the relative path <code>examples/demo-cluster-host.yaml</code>, including <code>$suffix</code>, <code>$api-server</code>, and <code>$kubeconfig</code>.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># View the kubeconfig for the host cluster.</span>
<span class="token function">cat</span> <span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.kube/config
</code></pre></div><div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Host cluster property template</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Cluster name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;host-$suffix&quot;</span>
  <span class="token comment"># Cluster API SERVER URL. Replace the variable with the address of the host cluster.</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;$api-server&quot;</span>
  <span class="token comment"># Cluster kind. Currently only supports Kubernetes.</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token comment"># Cluster type: virtual or physical</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;physical&quot;</span>
  <span class="token comment"># Cluster usage: host or worker</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
  <span class="token comment"># Primary domain, replace $cluster-ip with the cluster IP.</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># Traefik configuration</span>
  <span class="token key atrule">traefik</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30080&quot;</span>
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30443&quot;</span>
  <span class="token comment"># Content of the kubeconfig file of the cluster. Replace the variable with the kubeconfig of the host cluster</span>
  <span class="token key atrule">kubeconfig</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    $kubeconfig</span>
</code></pre></div><p>The host cluster property example after replacing the variables is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;host-aliyun&quot;</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;https://8.217.50.114:6443&quot;</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;physical&quot;</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;host&quot;</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">traefik</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30080&quot;</span>
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;30443&quot;</span>
  <span class="token key atrule">kubeconfig</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    apiVersion: v1
    clusters:
    - cluster:
        certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJlRENDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT0RFeU9UQXdPVFV3SGhjTk1qTXdOREV5TURrd01UTTFXaGNOTXpNd05EQTVNRGt3TVRNMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT0RFeU9UQXdPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFSMzRuTjVPWWhxb3MrekV1YXZsVDRleXE4ZFRVZ2pxcUdoN2Z6NkpMZEMKem1FN0cwZjE5K0hLcEw5cU1tSXVBaStRelBZZFNzWGJpR20rNjR0R0NuVkRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVUp0WVUxbkNvTXNNYWpVeUJGN3RVCndjZWJ6TW93Q2dZSUtvWkl6ajBFQXdJRFNRQXdSZ0loQU9hR2pWNlRpK2o1Yy9kWlV5a1pERml0OU9DdkFmZjEKWjJSVUJ6TkJTOUlhQWlFQTB1bzM2YUVGRnkvdWQ0eHREZnNkWmhYWmZOaXQ3c2N4SXREa1k5STlQUkU9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
        server: https://127.0.0.1:6443
      name: default
    contexts:
    - context:
        cluster: default
        user: default
      name: default
    current-context: default
    kind: Config
    preferences: {}
    users:
    - name: default
      user:
        client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrVENDQVRlZ0F3SUJBZ0lJSjYyRGdFT3JiM3d3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOamd4TWprd01EazFNQjRYRFRJek1EUXhNakE1TURFek5Wb1hEVEkwTURReApNVEE1TURFek5Wb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJJNnlLRlBKNENmS25BUFkKQ0Q5ZFVtZlZ5ekR2aFpEQUdhU1lYODVoWWRYZ0NKdmxHRmlad3dGN2ExKzEzdlQ5ZjE2MUJwSGhKTm9mYi9oeAozUVo1MWs2alNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCVHhiVTM2eC9iMnl3WU14SmpuUjF5L2w2cHZCREFLQmdncWhrak9QUVFEQWdOSUFEQkYKQWlFQS9rZ3FCOGJLZnNLSGNmaDBUSFQ2bTZNLzdrMzlNWmFGYlVCaE9GTzVDSW9DSURiRWNaeUxkc055R3lVVQpSTDl5K0hHcVJ3b1FTWGhOa1NrQjhlbkpsQTEzCi0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyT0RFeU9UQXdPVFV3SGhjTk1qTXdOREV5TURrd01UTTFXaGNOTXpNd05EQTVNRGt3TVRNMQpXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyT0RFeU9UQXdPVFV3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFTbnNEVkxLTU4xTWl4cHAwclRMRTBOVGdjamFRWFhmUmZmOThiOTRqd1gKYjRPNVh1aCtFclZwZ3BjamxRYjVZKzM0T1NwaG03TnVXWlA2OHBkUWhMTW5vMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVThXMU4rc2YyOXNzR0RNU1k1MGRjCnY1ZXFid1F3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUtXSStXQ2wwRFlJME5oVDBzbDkwSVRHRW05V2EyaE0KQXV4UXkrcDVUcGpzQWlBdWxFd0NkK2lWYXNVY2VHa2I4WU81dlduQitaTVJmSU1rYWRHSGhpSmlrdz09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K
        client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSU5ZZFVkaER2SlFXcVNSRzR0d3gzQ2I4amhnck1HZlVOMG1uajV5dTRWZ1RvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFanJJb1U4bmdKOHFjQTlnSVAxMVNaOVhMTU8rRmtNQVpwSmhmem1GaDFlQUltK1VZV0puRApBWHRyWDdYZTlQMS9YclVHa2VFazJoOXYrSEhkQm5uV1RnPT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo=</span>
</code></pre></div><p>Download the <a href="https://github.com/nautes-labs/cli/releases/tag/v0.3.0" target="_blank" rel="noopener noreferrer">command-line tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and run the following command to register the host cluster.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># examples/demo-cluster-host.yaml refers to the relative path of the template file in the command-line repository.</span>
<span class="token comment"># gitlab-access-token refers to the GitLab access token.</span>
<span class="token comment"># api-server-address refers to the access address of the Nautes API Server.</span>
nautes apply <span class="token parameter variable">-f</span> examples/demo-cluster-host.yaml <span class="token parameter variable">-t</span> <span class="token variable">$gitlab</span>-access-token <span class="token parameter variable">-s</span> <span class="token variable">$api</span>-server-address
</code></pre></div><p>Replace the variables in the virtual cluster property template located at the relative path <code>examples/demo-cluster-virtual-worker-pipeline.yaml</code>, including <code>$suffix</code>, <code>$api-server</code>, <code>$cluster-ip</code>, and <code>$api-server-port</code>.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Virtual cluster property template</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Cluster name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;vcluster-$suffix&quot;</span>
  <span class="token comment"># Cluster API SERVER URL. Replace the parameter with the format 'https://$hostcluster-ip:$api-server-port', where $hostcluster-ip refers to the IP of the host cluster and $api-server-port refers to the API SERVER port of the virtual cluster.</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;$api-server&quot;</span>
  <span class="token comment"># Cluster kind: Currently only supports Kubernetes</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token comment"># Cluster type: virtual or physical</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;virtual&quot;</span>
  <span class="token comment"># Cluster usage: host or worker</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;worker&quot;</span>
  <span class="token comment"># Runtime type: pipeline runtime</span>
  <span class="token key atrule">workerType</span><span class="token punctuation">:</span> <span class="token string">&quot;pipeline&quot;</span>
  <span class="token comment"># Host cluster: the property is only available for virtual type clusters. Replace the parameter with the name of the host cluster.</span>
  <span class="token key atrule">hostCluster</span><span class="token punctuation">:</span> <span class="token string">&quot;$host-cluster&quot;</span>
  <span class="token comment"># Primary domain, Replace $cluster-ip with the host cluster IP.</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># Tekton domain. Replace $cluster-ip with the host cluster IP.</span>
  <span class="token key atrule">tektonHost</span><span class="token punctuation">:</span> <span class="token string">&quot;tekton.vcluster-$suffix.$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># ArgoCD domain. Replace $cluster-ip with the host cluster IP.</span>
  <span class="token key atrule">argocdHost</span><span class="token punctuation">:</span> <span class="token string">&quot;argocd.vcluster-$suffix.$cluster-ip.nip.io&quot;</span>
  <span class="token comment"># Virtual cluster configuration: the property is only available for virtual type clusters.</span>
  <span class="token key atrule">vcluster</span><span class="token punctuation">:</span> 
    <span class="token comment"># API SERVER port </span>
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;$api-server-port&quot;</span>
</code></pre></div><p>The virtual cluster property example after replacing the variables is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Cluster
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> <span class="token string">&quot;vcluster-aliyun&quot;</span>
  <span class="token key atrule">apiServer</span><span class="token punctuation">:</span> <span class="token string">&quot;https://8.217.50.114:31456&quot;</span>
  <span class="token key atrule">clusterKind</span><span class="token punctuation">:</span> <span class="token string">&quot;kubernetes&quot;</span>
  <span class="token key atrule">clusterType</span><span class="token punctuation">:</span> <span class="token string">&quot;virtual&quot;</span>
  <span class="token key atrule">usage</span><span class="token punctuation">:</span> <span class="token string">&quot;worker&quot;</span>
  <span class="token key atrule">workerType</span><span class="token punctuation">:</span> <span class="token string">&quot;pipeline&quot;</span>
  <span class="token key atrule">hostCluster</span><span class="token punctuation">:</span> <span class="token string">&quot;host-aliyun&quot;</span>
  <span class="token key atrule">primaryDomain</span><span class="token punctuation">:</span> <span class="token string">&quot;8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">tektonHost</span><span class="token punctuation">:</span> <span class="token string">&quot;tekton.vcluster-aliyun.8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">argocdHost</span><span class="token punctuation">:</span> <span class="token string">&quot;argocd.vcluster-aliyun.8.217.50.114.nip.io&quot;</span>
  <span class="token key atrule">vcluster</span><span class="token punctuation">:</span> 
    <span class="token key atrule">httpsNodePort</span><span class="token punctuation">:</span> <span class="token string">&quot;31456&quot;</span>
</code></pre></div><p>Run the following command to register the virtual cluster.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># examples/demo-cluster-virtual-worker-pipeline.yaml refers to the relative path of the template file in the command-line repository.</span>
<span class="token comment"># gitlab-access-token refers to the GitLab access token.</span>
<span class="token comment"># api-server-address refers to the access address of the Nautes API Server.</span>
nautes apply <span class="token parameter variable">-f</span> examples/demo-cluster-virtual-worker-pipeline.yaml <span class="token parameter variable">-t</span> <span class="token variable">$gitlab</span>-access-token <span class="token parameter variable">-s</span> <span class="token variable">$api</span>-server-address
</code></pre></div><h2 id="initialize-a-product"><a href="#initialize-a-product" class="header-anchor">#</a> Initialize a Product</h2> <p>Initializing the product refers to creating various entities in the Nautes product model, and initializing a set of resources for running the pipeline in the runtime cluster, including namespace, serviceaccount, secret, argoevents and Tekton related resources, etc.</p> <p>The following sections describe the entities related to initializing the product through the command-line, including a product, a project, two code repositories, an authorization, an environment, and a project pipeline runtime.</p> <p>Clone the command-line repository to your local machine.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/nautes-labs/cli.git
</code></pre></div><p>Replace the variables in the property template located at the relative path <code>examples/demo-product.yaml</code>, including <code>$suffix</code>.</p> <blockquote><p>Here are two code repositories created: &quot;source code repository&quot; is used to store project source code and pipeline configuration files, while &quot;deployment configuration repository&quot; is used to store project deployment manifests.</p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token comment"># Product</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Product
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token comment"># Product name</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
      <span class="token comment"># Product path</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
      <span class="token key atrule">parentID</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">---</span>
<span class="token comment"># Project</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;nautes.resource.nautes.io/v1alpha1&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Project
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Project name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The product to which the project belongs</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">language</span><span class="token punctuation">:</span> golang
<span class="token punctuation">---</span>
<span class="token comment"># Source code repository</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Coderepo name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">codeRepoProvider</span><span class="token punctuation">:</span> gitlab
  <span class="token key atrule">deploymentRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">pipelineRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token comment"># The product to which the coderepo belongs</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The project to which the coderepo belongs</span>
  <span class="token key atrule">project</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;push_events&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token comment"># Repository name</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
      <span class="token comment"># Repository path</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix 
      <span class="token comment"># Repository visibility：private or public</span>
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
<span class="token punctuation">---</span>
<span class="token comment"># Deployment configuration repository</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Coderepo name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">codeRepoProvider</span><span class="token punctuation">:</span> gitlab
  <span class="token key atrule">deploymentRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">pipelineRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># The product to which the coderepo belongs</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;push_events&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token comment"># Repository name</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
      <span class="token comment"># Repository path</span>
      <span class="token key atrule">path</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix 
      <span class="token comment"># Repository visibility：private or public</span>
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
</code></pre></div><p>The file example after replacing the variables is shown below:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Product
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">path</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">parentID</span><span class="token punctuation">:</span> <span class="token number">0</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> <span class="token string">&quot;nautes.resource.nautes.io/v1alpha1&quot;</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Project
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">language</span><span class="token punctuation">:</span> golang
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">codeRepoProvider</span><span class="token punctuation">:</span> gitlab
  <span class="token key atrule">deploymentRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">pipelineRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">project</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;push_events&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">path</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart 
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">codeRepoProvider</span><span class="token punctuation">:</span> gitlab
  <span class="token key atrule">deploymentRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">pipelineRuntime</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">webhook</span><span class="token punctuation">:</span>
    <span class="token key atrule">events</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;push_events&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">git</span><span class="token punctuation">:</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">path</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart 
      <span class="token key atrule">visibility</span><span class="token punctuation">:</span> private
      <span class="token key atrule">description</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
</code></pre></div><p>Replace the variables in the property template located at the relative path <code>examples/demo-pipeline.yaml</code>, including <code>$suffix</code> and <code>$pipeline-runtime-cluster</code>.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token comment"># Development environment</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Environment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># Environment name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> env<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The product to which the environment belongs</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># Runtime cluster related to the environment</span>
  <span class="token key atrule">cluster</span><span class="token punctuation">:</span> $pipeline<span class="token punctuation">-</span>runtime<span class="token punctuation">-</span>cluster
  <span class="token comment"># Environment type</span>
  <span class="token key atrule">envType</span><span class="token punctuation">:</span> dev
<span class="token punctuation">---</span>
<span class="token comment"># Grant deployment configuration repository authorization to the project pipeline runtime.</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepoBinding
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># The product to which the authorized code repository belongs.</span>
  <span class="token key atrule">productName</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepobinding<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>pipeline<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># Authorized code repository</span>
  <span class="token key atrule">coderepo</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The product with granted authorization</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The projects with granted authorization</span>
  <span class="token key atrule">projects</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># Permission: readonly, readwrite</span>
  <span class="token key atrule">permissions</span><span class="token punctuation">:</span> readwrite
<span class="token punctuation">---</span>
<span class="token comment"># ProjectPipelineRuntime</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ProjectPipelineRuntime
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token comment"># ProjectPipelineRuntime name</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pr<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The product to which the project pipeline runtime belongs</span>
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The project to which the project pipeline runtime belongs</span>
  <span class="token key atrule">project</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The source coderepo of the pipeline configuration</span>
  <span class="token key atrule">pipelineSource</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The definition of pipelines</span>
  <span class="token key atrule">pipelines</span><span class="token punctuation">:</span>
    <span class="token comment"># Pipeline name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
    <span class="token comment"># The label of pipeline resources</span>
    <span class="token key atrule">label</span><span class="token punctuation">:</span> main
    <span class="token comment"># The relative path of pipeline configuration files</span>
    <span class="token key atrule">path</span><span class="token punctuation">:</span> pipelines/main.yaml
  <span class="token comment"># The target environment of the project pipeline runtime</span>
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> env<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
  <span class="token comment"># The event sources triggered pipelines</span>
  <span class="token key atrule">eventSources</span><span class="token punctuation">:</span>
    <span class="token comment"># The event source name</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook
    <span class="token comment"># Gitlab event source</span>
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token comment"># Repository name</span>
      <span class="token key atrule">repoName</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
      <span class="token comment"># Repository branch that generates events, where &quot;*&quot; indicates that the event source receives events from all branches.</span>
      <span class="token key atrule">revision</span><span class="token punctuation">:</span> main
      <span class="token comment"># Event types received by the event source from the repository.</span>
      <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> push_events
  <span class="token comment"># The isolation of the resources related to the pipelines: shared（default）or exclusive</span>
  <span class="token key atrule">isolation</span><span class="token punctuation">:</span> exclusive
  <span class="token comment"># Associate pipelines and event sources</span>
  <span class="token key atrule">pipelineTriggers</span><span class="token punctuation">:</span>
    <span class="token comment"># Associated event source</span>
  <span class="token punctuation">-</span> <span class="token key atrule">eventSource</span><span class="token punctuation">:</span> webhook
    <span class="token comment"># Associated pipeline</span>
    <span class="token key atrule">pipeline</span><span class="token punctuation">:</span> pipeline<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>$suffix
</code></pre></div><p>The file example after replacing the variables is shown below:</p> <blockquote><p>According to the cluster type selected in the previous section, you need to set <code>spec.cluster</code> of Environment resource to the <a href="#register-physical-cluster">physical cluster name</a> or <a href="#register-virtual-cluster">virtual cluster name</a>.</p></blockquote> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Environment
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> env<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">cluster</span><span class="token punctuation">:</span> vcluster<span class="token punctuation">-</span>aliyun
  <span class="token key atrule">envType</span><span class="token punctuation">:</span> dev
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> CodeRepoBinding
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">productName</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">name</span><span class="token punctuation">:</span> coderepobinding<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>pipeline<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">coderepo</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>deploy<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">projects</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">permissions</span><span class="token punctuation">:</span> readwrite
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> nautes.resource.nautes.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ProjectPipelineRuntime
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pr<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">product</span><span class="token punctuation">:</span> demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">project</span><span class="token punctuation">:</span> project<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">pipelineSource</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">pipelines</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pipeline<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
    <span class="token key atrule">label</span><span class="token punctuation">:</span> main
    <span class="token key atrule">path</span><span class="token punctuation">:</span> pipelines/main.yaml
  <span class="token key atrule">destination</span><span class="token punctuation">:</span> env<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
  <span class="token key atrule">eventSources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> webhook
    <span class="token key atrule">gitlab</span><span class="token punctuation">:</span>
      <span class="token key atrule">repoName</span><span class="token punctuation">:</span> coderepo<span class="token punctuation">-</span>sc<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
      <span class="token key atrule">revision</span><span class="token punctuation">:</span> main
      <span class="token key atrule">events</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> push_events
  <span class="token key atrule">isolation</span><span class="token punctuation">:</span> exclusive
  <span class="token key atrule">pipelineTriggers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">eventSource</span><span class="token punctuation">:</span> webhook
    <span class="token key atrule">pipeline</span><span class="token punctuation">:</span> pipeline<span class="token punctuation">-</span>dev<span class="token punctuation">-</span>demo<span class="token punctuation">-</span>quickstart
</code></pre></div><p>Download the <a href="https://github.com/nautes-labs/cli/releases/tag/v0.3.0" target="_blank" rel="noopener noreferrer">command-line tool<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> and run the following command to initialize the product.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># examples/demo-product.yaml and examples/demo-pipeline.yaml refers to the relative path of the template file in the command-line repository.</span>
<span class="token comment"># gitlab-access-token refers to the GitLab access token.</span>
<span class="token comment"># api-server-address refers to the access address of the Nautes API Server.</span>
nautes apply <span class="token parameter variable">-f</span> examples/demo-product.yaml <span class="token parameter variable">-t</span> <span class="token variable">$gitlab</span>-access-token <span class="token parameter variable">-s</span> <span class="token variable">$api</span>-server-address
nautes apply <span class="token parameter variable">-f</span> examples/demo-pipeline.yaml <span class="token parameter variable">-t</span> <span class="token variable">$gitlab</span>-access-token <span class="token parameter variable">-s</span> <span class="token variable">$api</span>-server-address
</code></pre></div><p>Before running the pipeline, you need to prepare an image repository for storing the container images generated by the pipeline. We will take GitHub's <code>ghcr.io</code> as an example.</p> <p>You need to prepare an account or organization on GitHub, for example, <code>https://github.com/nautes-labs</code>, and generate a personal access token with <code>write:packages</code> permission under the account that has permissions to the organization.</p> <p>When a namespace with the same name as the project pipeline runtime is ready in the runtime cluster, you need to create a ConfigMap resource under the namespace. The <code>image-build</code> task in the pipeline can use the ConfigMap resource to authenticate with the image repository when pushing container images.</p> <p>The template for the ConfigMap resource is located at the relative path <code>examples/config.json</code>. You need to replace the <code>$auth</code> variable in it with the string generated by the following command:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># github-user refers to your GitHub account</span>
<span class="token comment"># github-token refers to the personal access token of your GitHub account</span>
<span class="token builtin class-name">echo</span> <span class="token parameter variable">-n</span> <span class="token string">'$github-user:$github-token'</span> <span class="token operator">|</span> base64
</code></pre></div><p>After replacing the variables, use the <code>kubectl</code> command to create the ConfigMap resource in the runtime cluster:</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token comment"># pipeline-runtime-name refers to the name of the project pipeline runtime, such as pr-demo-quickstart</span>
kubectl create configmap registry-auth --from-file<span class="token operator">=</span>config.json <span class="token parameter variable">-n</span> <span class="token variable">$pipeline</span>-runtime-name
</code></pre></div><h2 id="run-a-pipeline-2"><a href="#run-a-pipeline-2" class="header-anchor">#</a> Run a Pipeline</h2> <p>Submit the source code and pipeline configuration files of the sample project to the source code repository, and submit the Kubernetes manifests of the sample project to the deployment configuration repository, such as deployment, service, and other resources.</p> <h3 id="submit-kubernetes-manifest"><a href="#submit-kubernetes-manifest" class="header-anchor">#</a> Submit Kubernetes Manifest</h3> <p>Clone the sample repository to your local machine.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/nautes-examples/user-deployment.git
</code></pre></div><p>Modify the domain name of the Ingress resource in the local code repository: <code>deployment/test/devops-sample-svc.yaml</code>.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> networking.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Ingress
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> ks<span class="token punctuation">-</span>sample<span class="token punctuation">-</span>dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token comment"># Replace $cluster-ip with the public IP of the runtime cluster.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">host</span><span class="token punctuation">:</span> devops<span class="token punctuation">-</span>sample.$cluster<span class="token punctuation">-</span>ip.nip.io
    <span class="token key atrule">http</span><span class="token punctuation">:</span>
      <span class="token key atrule">paths</span><span class="token punctuation">:</span>
      <span class="token punctuation">...</span>
</code></pre></div><p>Access <a href="/en/guide/user-guide/installation.html#check-the-installation-results">GitLab</a>, and configure your GitLab account to have the force-push permission to the <code>main</code> branch of the <a href="#initialize-a-product">deployment configuration repository</a>. For more information, refer to  <a href="https://docs.gitlab.com/ee/user/project/protected_branches.html#allow-force-push-on-a-protected-branch" target="_blank" rel="noopener noreferrer">Allow Force Push to a Protected Branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Push the Kubernetes Manifests to the deployment configuration repository.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># Change the URL of the remote repository 'origin' to that of the deployment configuration repository, </span>
<span class="token comment"># the repository URL below is only an example, replace $gitlab-url with the IP or domain of GitLab.</span>
<span class="token function">git</span> remote set-url origin git@<span class="token variable">$gitlab</span>-url:demo-quickstart/coderepo-deploy-demo-quickstart.git
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'submit the kubernetes manifests.'</span>
<span class="token function">git</span> push origin main <span class="token parameter variable">-f</span>
</code></pre></div><h3 id="submit-pipeline-configuration"><a href="#submit-pipeline-configuration" class="header-anchor">#</a> Submit Pipeline Configuration</h3> <p>Clone the sample repository to your local machine.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">git</span> clone https://github.com/nautes-examples/user-pipeline.git
</code></pre></div><p>Replace variables in the pipeline configuration file <code>pipelines/main.yaml</code> in the code repository, including:</p> <p><strong>$pipeline-runtime-name</strong> should be replaced with the project pipeline runtime name, such as <code>pr-demo-quickstart</code>.</p> <p><strong>$sc-repo-id</strong> should be replaced with the source code repository ID, which you can find on the <code>Project</code> home page in the Gitlab console.</p> <p><strong>$sc-repo-url</strong> should be replaced with the SSH URL of the source code repository, which you can find on the <code>Project</code> home page in the Gitlab console, such as <code>git@$gitlab-url:demo-quickstart/coderepo-sc-demo-quickstart.git</code>.</p> <p><strong>$deploy-repo-url</strong> should be replaced with the SSH URL of the deployment configuration repository.  The method for finding SSH URL is similar to <strong>$sc-repo-url</strong>.</p> <p><strong>$registry-url</strong> should be replaced with the URL of the container image repository, such as <code>ghcr.io/nautes-labs</code>.</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> tekton.dev/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PipelineRun
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> main<span class="token punctuation">-</span>pipiline
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">params</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> REVISION
    <span class="token key atrule">value</span><span class="token punctuation">:</span> main
  <span class="token key atrule">taskRunSpecs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pipelineTaskName</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>sourcecode
    <span class="token key atrule">taskServiceAccountName</span><span class="token punctuation">:</span> nautes<span class="token punctuation">-</span>sa
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-pre-populate-only</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/tls-secret</span><span class="token punctuation">:</span> <span class="token string">&quot;ca&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/ca-cert</span><span class="token punctuation">:</span> <span class="token string">&quot;/vault/tls/ca.crt&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/role</span><span class="token punctuation">:</span> <span class="token string">'$pipeline-runtime-name'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-user</span><span class="token punctuation">:</span> <span class="token string">'0'</span> 
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-group</span><span class="token punctuation">:</span> <span class="token string">'0'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-secret-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;git/data/gitlab/repo-$sc-repo-id/default/readonly&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/secret-volume-path-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;/root/.ssh&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-perms-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">'0400'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-template-id_ecdsa</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          {{- with secret &quot;git/data/gitlab/repo-$sc-repo-id/default/readonly&quot; -}}
          {{ .Data.data.deploykey }}
          {{- end -}}</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pipelineTaskName</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>deployment
    <span class="token key atrule">taskServiceAccountName</span><span class="token punctuation">:</span> nautes<span class="token punctuation">-</span>sa
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-pre-populate-only</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/tls-secret</span><span class="token punctuation">:</span> <span class="token string">&quot;ca&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/ca-cert</span><span class="token punctuation">:</span> <span class="token string">&quot;/vault/tls/ca.crt&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/role</span><span class="token punctuation">:</span> <span class="token string">'$pipeline-runtime-name'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-user</span><span class="token punctuation">:</span> <span class="token string">'0'</span> 
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-group</span><span class="token punctuation">:</span> <span class="token string">'0'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-secret-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;git/data/gitlab/repo-$sc-repo-id/default/readwrite&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/secret-volume-path-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;/root/.ssh&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-perms-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">'0400'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-template-id_ecdsa</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          {{- with secret &quot;git/data/gitlab/repo-$sc-repo-id/default/readwrite&quot; -}}
          {{ .Data.data.deploykey }}
          {{- end -}}</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pipelineTaskName</span><span class="token punctuation">:</span> manifest<span class="token punctuation">-</span>update
    <span class="token key atrule">taskServiceAccountName</span><span class="token punctuation">:</span> nautes<span class="token punctuation">-</span>sa
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject</span><span class="token punctuation">:</span> <span class="token string">'true'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-pre-populate-only</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/tls-secret</span><span class="token punctuation">:</span> <span class="token string">&quot;ca&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/ca-cert</span><span class="token punctuation">:</span> <span class="token string">&quot;/vault/tls/ca.crt&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/role</span><span class="token punctuation">:</span> <span class="token string">'$pipeline-runtime-name'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-user</span><span class="token punctuation">:</span> <span class="token string">'0'</span> 
        <span class="token key atrule">vault.hashicorp.com/agent-run-as-group</span><span class="token punctuation">:</span> <span class="token string">'0'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-secret-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;git/data/gitlab/repo-$sc-repo-id/default/readwrite&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/secret-volume-path-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">&quot;/root/.ssh&quot;</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-perms-id_ecdsa</span><span class="token punctuation">:</span> <span class="token string">'0400'</span>
        <span class="token key atrule">vault.hashicorp.com/agent-inject-template-id_ecdsa</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          {{- with secret &quot;git/data/gitlab/repo-$sc-repo-id/default/readwrite&quot; -}}
          {{ .Data.data.deploykey }}
          {{- end -}}</span>
  <span class="token key atrule">pipelineSpec</span><span class="token punctuation">:</span>
    <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> REVISION
        <span class="token key atrule">type</span><span class="token punctuation">:</span> string
        <span class="token key atrule">description</span><span class="token punctuation">:</span> Revision to checkout. (branch<span class="token punctuation">,</span> tag<span class="token punctuation">,</span> sha<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> etc<span class="token punctuation">...</span>)
        <span class="token key atrule">default</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
    <span class="token key atrule">tasks</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>sourcecode
      <span class="token key atrule">taskRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterTask
      <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> output
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> url
        <span class="token key atrule">value</span><span class="token punctuation">:</span> $sc<span class="token punctuation">-</span>repo<span class="token punctuation">-</span>url
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> revision
        <span class="token key atrule">value</span><span class="token punctuation">:</span> $(params.REVISION)
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> subdirectory
        <span class="token key atrule">value</span><span class="token punctuation">:</span> sourcecode
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>deployment
      <span class="token key atrule">runAfter</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>sourcecode
      <span class="token key atrule">taskRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>clone
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterTask
      <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> output
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> url
        <span class="token key atrule">value</span><span class="token punctuation">:</span> $deploy<span class="token punctuation">-</span>repo<span class="token punctuation">-</span>url
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> revision
        <span class="token key atrule">value</span><span class="token punctuation">:</span> $(params.REVISION)
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> subdirectory
        <span class="token key atrule">value</span><span class="token punctuation">:</span> deployment
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> mvn<span class="token punctuation">-</span>build
      <span class="token key atrule">runAfter</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>deployment
      <span class="token key atrule">taskRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> maven
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterTask
      <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> source
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>settings
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> empty<span class="token punctuation">-</span>dir
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>repository
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>repository<span class="token punctuation">-</span>volume
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GOALS
        <span class="token key atrule">value</span><span class="token punctuation">:</span> 
          <span class="token punctuation">-</span> <span class="token punctuation">-</span>DskipTests
          <span class="token punctuation">-</span> clean
          <span class="token punctuation">-</span> install
          <span class="token punctuation">-</span> <span class="token punctuation">-</span>f
          <span class="token punctuation">-</span> sourcecode/pom.xml
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> image<span class="token punctuation">-</span>build
      <span class="token key atrule">runAfter</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mvn<span class="token punctuation">-</span>build
      <span class="token key atrule">taskRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> kaniko
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterTask
      <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> source
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dockerconfig
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> dockerconfig<span class="token punctuation">-</span>volume
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> IMAGE
        <span class="token key atrule">value</span><span class="token punctuation">:</span> $registry<span class="token punctuation">-</span>url/devops<span class="token punctuation">-</span>sample<span class="token punctuation">:</span>0.0.1<span class="token punctuation">-</span>$(tasks.git<span class="token punctuation">-</span>clone<span class="token punctuation">-</span>sourcecode.results.commit)
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> DOCKERFILE
        <span class="token key atrule">value</span><span class="token punctuation">:</span> ./sourcecode/Dockerfile
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> CONTEXT
        <span class="token key atrule">value</span><span class="token punctuation">:</span> ./sourcecode
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> manifest<span class="token punctuation">-</span>update
      <span class="token key atrule">runAfter</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> image<span class="token punctuation">-</span>build
      <span class="token key atrule">taskRef</span><span class="token punctuation">:</span>
        <span class="token key atrule">name</span><span class="token punctuation">:</span> git<span class="token punctuation">-</span>cli
        <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterTask
      <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> source
        <span class="token key atrule">workspace</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
      <span class="token key atrule">params</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> BASE_IMAGE
        <span class="token key atrule">value</span><span class="token punctuation">:</span> gcr.io/tekton<span class="token punctuation">-</span>releases/github.com/tektoncd/pipeline/cmd/git<span class="token punctuation">-</span>init<span class="token punctuation">:</span>v0.29.0
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GIT_USER_NAME
        <span class="token key atrule">value</span><span class="token punctuation">:</span> pipelinerobot
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GIT_USER_EMAIL
        <span class="token key atrule">value</span><span class="token punctuation">:</span> pipelinerobot@nautes.io
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> GIT_SCRIPT
        <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
          cd deployment
          sed -i -e &quot;s#ghcr.io/lanbingcloud/devops-sample.*#$(tasks.image-build.results.IMAGE_URL)#g&quot; deployments/test/devops-sample.yaml 
          git add deployments/test/devops-sample.yaml
          git commit -a -m &quot;automatic update by pipeline bot: $(tasks.image-build.results.IMAGE_URL)&quot;
          git push origin HEAD:$(params.REVISION) --force</span>
    <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> empty<span class="token punctuation">-</span>dir
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>repository<span class="token punctuation">-</span>volume
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dockerconfig<span class="token punctuation">-</span>volume
  <span class="token key atrule">workspaces</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> empty<span class="token punctuation">-</span>dir
    <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> source<span class="token punctuation">-</span>volume
    <span class="token key atrule">volumeClaimTemplate</span><span class="token punctuation">:</span>
      <span class="token key atrule">spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> ReadWriteOnce
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">storage</span><span class="token punctuation">:</span> 50M
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> maven<span class="token punctuation">-</span>repository<span class="token punctuation">-</span>volume
    <span class="token key atrule">volumeClaimTemplate</span><span class="token punctuation">:</span>
      <span class="token key atrule">spec</span><span class="token punctuation">:</span>
        <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> ReadWriteOnce
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">storage</span><span class="token punctuation">:</span> 500M
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dockerconfig<span class="token punctuation">-</span>volume
    <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
      <span class="token key atrule">name</span><span class="token punctuation">:</span> registry<span class="token punctuation">-</span>auth
</code></pre></div><p>Access <a href="/en/guide/user-guide/installation.html#check-the-installation-results">GitLab</a>, and configure your GitLab account to have the force-push permission to the <code>main</code> branch of the <a href="#initialize-a-product">source code repository</a>. For more information, refer to <a href="https://docs.gitlab.com/ee/user/project/protected_branches.html#allow-force-push-on-a-protected-branch" target="_blank" rel="noopener noreferrer">Allow Force Push to a Protected Branch<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <p>Push the pipeline configuration files to the source code repository.</p> <div class="language-Shell extra-class"><pre class="language-shell"><code><span class="token comment"># Change the URL of the remote repository 'origin' to that of the source code repository,</span>
<span class="token comment"># the repository URL below is only an example, replace $gitlab-url with the IP or domain of GitLab.</span>
<span class="token function">git</span> remote set-url origin git@<span class="token variable">$gitlab</span>-url:demo-quickstart/coderepo-sc-demo-quickstart.git
<span class="token function">git</span> <span class="token function">add</span> <span class="token builtin class-name">.</span>
<span class="token function">git</span> commit <span class="token parameter variable">-m</span> <span class="token string">'submit the pipeline configurations.'</span>
<span class="token function">git</span> push origin main <span class="token parameter variable">-f</span>
</code></pre></div><h2 id="view-pipeline-results"><a href="#view-pipeline-results" class="header-anchor">#</a> View Pipeline Results</h2> <h3 id="pipeline"><a href="#pipeline" class="header-anchor">#</a> Pipeline</h3> <p>After you submit the pipeline configurations to the source code repository, Nautes will respond to the Webhook callback from the code repository, and trigger the pipelines in the cluster declared in the project pipeline runtime.</p> <p>You can view the pipeline information in the Tekton Dashboard by using a browser to access <code>https://$tekonHost:$traefik-httpsNodePort</code>.</p> <blockquote><p>Replace the $tekonHost variable with the tekonHost address of the runtime cluster. For more information, refer to <code>spec.tekonHost</code> in the property template in the <a href="#register-physical-cluster">Register Physical Cluster</a> or <a href="#register-virtual-cluster">Register Virtual Cluster</a> section, for example, <code>tekton.vcluster-aliyun.8.217.50.114.nip.io</code>.</p> <p>Replace the $traefik-httpsNodePort variable with the traefik port of the runtime cluster. For more information, refer to <code>spec.traefik.httpsNodePort</code> in the property template in the <a href="#register-physical-cluster">Register Physical Cluster</a> or <a href="#register-virtual-cluster">Register Virtual Cluster</a> section, for example, <code>30443</code>.</p></blockquote> <p>When you access the Tekton Dashboard, if you haven't logged into the GitLab in the current browser session, the action will trigger unified authentication. During the authentication process, you need to enter your GitLab account and password to log in. After successful login, the page will automatically redirect to the Tekton Dashboard.</p> <h3 id="image-repository"><a href="#image-repository" class="header-anchor">#</a> Image Repository</h3> <p>If the pipelines have been successfully executed, you can view the newly added images in the image repository (for example: <code>https://github.com/orgs/nautes-labs/packages</code>). To pull the images, you can use a similar command.</p> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">docker</span> pull ghcr.io/nautes-labs/devops-sample:0.0.1-bdcdba83f17169db12e95bc9ff0592ace612016b
</code></pre></div><h3 id="deployment-manifest"><a href="#deployment-manifest" class="header-anchor">#</a> Deployment Manifest</h3> <p>If the pipelines have been successfully executed, you can observe that the container image tags have been automatically updated to the versions containing the latest commit ID in the files within the deployment configuration repository (for example: <code>deployments/test/devops-sample.yaml</code>). The configuration snippet is as follows:</p> <div class="language-yaml extra-class"><pre class="language-yaml"><code><span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> ks<span class="token punctuation">-</span>sample
          <span class="token key atrule">image</span><span class="token punctuation">:</span> ghcr.io/nautes<span class="token punctuation">-</span>labs/devops<span class="token punctuation">-</span>sample<span class="token punctuation">:</span>0.0.1<span class="token punctuation">-</span>bdcdba83f17169db12e95bc9ff0592ace612016b
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/en/guide/user-guide/installation.html" class="prev">
        Installation
      </a></span> <span class="next"><a href="/en/guide/user-guide/deploy-an-application.html">
        Deploy an Application
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.6f7c6124.js" defer></script><script src="/assets/js/2.5cda13a8.js" defer></script><script src="/assets/js/46.df43c17b.js" defer></script>
  </body>
</html>
