(window.webpackJsonp=window.webpackJsonp||[]).push([[43],{320:function(e,t,a){"use strict";a.r(t);var s=a(14),n=Object(s.a)({},(function(){var e=this,t=e._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#installation"}},[e._v("#")]),e._v(" Installation")]),e._v(" "),t("p",[e._v("Nautes supports installation on public cloud, private cloud, hosts, and Kubernetes clusters. This document uses Alibaba Cloud as an example to describe the process of installing Nautes on a public cloud.")]),e._v(" "),t("h2",{attrs:{id:"prepare-the-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prepare-the-environment"}},[e._v("#")]),e._v(" Prepare the Environment")]),e._v(" "),t("ul",[t("li",[e._v("Installation machine: An AMD64 architecture Linux server, with Docker, Git, and Bash pre-installed, and ensure that the "),t("code",[e._v("/opt/nautes")]),e._v(" directory is not occupied.")]),e._v(" "),t("li",[e._v("Public cloud access key: An access key for an Alibaba Cloud account. If you are using a RAM user, make sure the RAM user has AliyunECSFullAccess and AliyunVPCFullAccess permissions. For more information, refer to "),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/116401.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("Create AccessKey"),t("OutboundLink")],1),e._v(".")])]),e._v(" "),t("blockquote",[t("p",[e._v("The installer will call Alibaba Cloud's API to apply for resources, which will incur some costs (please refer to "),t("a",{attrs:{href:"#alibaba-cloud-cost-description"}},[e._v("Alibaba Cloud Cost Description")]),e._v(").")]),e._v(" "),t("p",[e._v("Due to Alibaba Cloud's billing rules restrictions, please ensure that the Alibaba Cloud account balance is more than 100 RMB, otherwise the installation program cannot call Alibaba Cloud's API to apply for resources.")])]),e._v(" "),t("h2",{attrs:{id:"execute-the-installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#execute-the-installation"}},[e._v("#")]),e._v(" Execute the Installation")]),e._v(" "),t("p",[e._v("Create configuration file for installer.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("cat")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[e._v("EOT"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[e._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">>")]),e._v(" vars.yaml")]),e._v("\naccess_key: < your alicloud access key >\nsecret_key: < your alicloud secret key >\nEOT")]),e._v("\n")])])]),t("p",[e._v("Run the following command for default installation.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" https://raw.githubusercontent.com/nautes-labs/installer/main/installer.sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v(" -\n")])])]),t("p",[e._v("or")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-OL")]),e._v(" https://raw.githubusercontent.com/nautes-labs/installer/main/installer.sh\n"),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" +x installer.sh\n./installer.sh\n")])])]),t("blockquote",[t("p",[e._v("By default, install a single-node K3s. Depending on the public network bandwidth of the installation machine, the entire installation process is expected to take 15~25 minutes. After the installation is successful, you can find the installed component information in the "),t("code",[e._v("/opt/nautes")]),e._v(" directory. If the installation fails, you can troubleshoot issues through the logs in the "),t("code",[e._v("/opt/nautes/out/logs")]),e._v(" directory.")])]),e._v(" "),t("h2",{attrs:{id:"check-the-installation-results"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#check-the-installation-results"}},[e._v("#")]),e._v(" Check the Installation Results")]),e._v(" "),t("p",[t("code",[e._v("/opt/nautes/flags")]),e._v(" stores the identification files of the installation progress. The installer will skip completed installation steps according to the identification files.")]),e._v(" "),t("p",[t("code",[e._v("/opt/nautes/terraform")]),e._v(" stores the terraform state file, which records the list of resources applied for by the installation program on Alibaba Cloud.")]),e._v(" "),t("p",[t("code",[e._v("/opt/nautes/out")]),e._v(" stores information about the installed components:")]),e._v(" "),t("ul",[t("li",[e._v("GitLab is used to store the tenant configuration repository, user application source code, deployment manifests, pipeline configurations, etc. GitLab's administrator password and tenant configuration repository access information are stored in the "),t("code",[e._v("gitlab")]),e._v(" subdirectory.")]),e._v(" "),t("li",[e._v("Vault is used to store and manage tenant secret data. Vault's unseal key and root token are stored in the "),t("code",[e._v("vault")]),e._v(" subdirectory.")]),e._v(" "),t("li",[e._v("Kubernetes clusters are used to host all management components of the tenant. The cluster's kubeconfig is stored in the "),t("code",[e._v("kubernetes")]),e._v(" subdirectory.")]),e._v(" "),t("li",[e._v("ArgoCD is used to watch to the tenant configuration repository and synchronize the tenant configuration to the Kubernetes cluster according to the configuration declarations in the repository. ArgoCD's administrator password is stored in the "),t("code",[e._v("argocd")]),e._v(" subdirectory.")]),e._v(" "),t("li",[e._v("Dex provides a unified authentication service based on the OIDC protocol. Dex's client secret is stored in the "),t("code",[e._v("kubernetes")]),e._v(" subdirectory.")])]),e._v(" "),t("p",[e._v("In addition, related information in other subdirectories under "),t("code",[e._v("/opt/nautes/out")]),e._v(":")]),e._v(" "),t("ul",[t("li",[e._v("hosts: IP addresses and access keys of the cloud server.")]),e._v(" "),t("li",[e._v("PKI: Certificates that are used to access the components and the CA that issues certificates.")]),e._v(" "),t("li",[e._v("service: Access addresses for the tenant management cluster, Dex, ArgoCD, Vault, GitLab, and Nautes API Server.")]),e._v(" "),t("li",[e._v("logs: Installation program logs.")])]),e._v(" "),t("blockquote",[t("p",[e._v("The relative path of the Nautes API Server's Swagger UI documentation is: /q/swagger-ui.")])]),e._v(" "),t("h2",{attrs:{id:"destroy-the-environment"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#destroy-the-environment"}},[e._v("#")]),e._v(" Destroy the Environment")]),e._v(" "),t("blockquote",[t("p",[e._v("Please make sure the "),t("code",[e._v("/opt/nautes directory")]),e._v(" has not been deleted on the installation machine, and under the directory where the destroy command is executed, there is a configuration file for the installation program called vars.yaml.")]),e._v(" "),t("p",[e._v("The uninstallation program will remove all resources applied from the cloud service, and it does not currently support uninstalling components individually.")])]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[e._v("curl")]),e._v(" https://raw.githubusercontent.com/nautes-labs/installer/main/installer.sh "),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[e._v("bash")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[e._v("-s")]),e._v(" destroy\n")])])]),t("p",[e._v("or")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[e._v("./installer.sh destroy\n")])])]),t("h2",{attrs:{id:"alibaba-cloud-cost-description"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#alibaba-cloud-cost-description"}},[e._v("#")]),e._v(" Alibaba Cloud Cost Description")]),e._v(" "),t("p",[e._v("The default specifications of the cloud server applied by the installer are as follows:")]),e._v(" "),t("ul",[t("li",[e._v("Region: China Hong Kong - Availability Zone B")]),e._v(" "),t("li",[e._v("Image: Ubuntu 22.04 64-bit")]),e._v(" "),t("li",[e._v("Instance Specification: ecs.c6.large (2C4G)")]),e._v(" "),t("li",[e._v("System Disk: ESSD Cloud Disk PL0 40G")]),e._v(" "),t("li",[e._v("Network: Public IP")]),e._v(" "),t("li",[e._v("Number: 2")]),e._v(" "),t("li",[e._v("Usage: K3s, Vault")])]),e._v(" "),t("hr"),e._v(" "),t("ul",[t("li",[e._v("Region: China Hong Kong - Availability Zone B")]),e._v(" "),t("li",[e._v("Image: Ubuntu 22.04 64-bit")]),e._v(" "),t("li",[e._v("Instance Specification: ecs.g5.large(2C8G)")]),e._v(" "),t("li",[e._v("System Disk: ESSD Cloud Disk PL0 40G")]),e._v(" "),t("li",[e._v("Network: Public IP")]),e._v(" "),t("li",[e._v("Number: 1")]),e._v(" "),t("li",[e._v("Usage: GitLab")])]),e._v(" "),t("p",[e._v("The installer uses the "),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/52088.html?spm=5176.ecsbuyv3.0.0.2a2736756P0dh1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Preemptible Instance Mode"),t("OutboundLink")],1),e._v(" to create cloud servers by default, which carries the risk of instances being automatically released. If you prefer a more stable environment, please add the following configuration to vars.yaml to switch to the "),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/40653.html?spm=5176.ecsbuyv3.0.0.2a2736756P0dh1",target:"_blank",rel:"noopener noreferrer"}},[e._v("Pay-As-You-Go Mode"),t("OutboundLink")],1),e._v(" for resources apply.")]),e._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("alicloud.save_money")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[e._v("false")]),e._v("\n")])])]),t("p",[e._v("The cost estimates for the two billing modes are as follows (excluding traffic fees):")]),e._v(" "),t("ul",[t("li",[e._v("Pay-As-You-Go: ￥ 56.1 pre Day")]),e._v(" "),t("li",[e._v("Preemptible Instance: ￥ 13.5 pre Day")])]),e._v(" "),t("blockquote",[t("p",[e._v("The actual costs incurred may be affected by market price fluctuations, and the above estimates are for reference only.")])]),e._v(" "),t("h2",{attrs:{id:"custom-installation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#custom-installation"}},[e._v("#")]),e._v(" Custom installation")]),e._v(" "),t("h3",{attrs:{id:"use-a-specified-version-of-the-installer-image"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#use-a-specified-version-of-the-installer-image"}},[e._v("#")]),e._v(" Use a specified version of the installer image")]),e._v(" "),t("p",[e._v("Before installation, set the environment variable INSTALLER_VERSION.")]),e._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("INSTALLER_VERSION")]),t("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("vX.Y.Z\n")])])]),t("h3",{attrs:{id:"use-a-specified-tenant-configuration-repository-template"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#use-a-specified-tenant-configuration-repository-template"}},[e._v("#")]),e._v(" Use a specified tenant configuration repository template")]),e._v(" "),t("p",[e._v("Before installation, add the following configuration to the vars.yaml file.")]),e._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("repos.tenant_template.url")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" https"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v("//github.com/nautes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("labs/tenant"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("repo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("-")]),e._v("template.git\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("repos.tenant_template.version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" main\n")])])]),t("h3",{attrs:{id:"use-standard-k8s"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#use-standard-k8s"}},[e._v("#")]),e._v(" Use standard K8s")]),e._v(" "),t("p",[e._v("Before installation, add the following configuration to the vars.yaml file.")]),e._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deploy.kubernetes.type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" k8s\n"),t("span",{pre:!0,attrs:{class:"token key atrule"}},[e._v("deploy.kubernetes.node_num")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(":")]),e._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),e._v("\n")])])]),t("h3",{attrs:{id:"complete-parameter-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#complete-parameter-list"}},[e._v("#")]),e._v(" Complete parameter list")]),e._v(" "),t("p",[e._v("Please refer to "),t("a",{attrs:{href:"https://github.com/nautes-labs/installer/blob/main/vars.yaml.sample",target:"_blank",rel:"noopener noreferrer"}},[e._v("vars.yaml.sample"),t("OutboundLink")],1),e._v(".")])])}),[],!1,null,null,null);t.default=n.exports}}]);