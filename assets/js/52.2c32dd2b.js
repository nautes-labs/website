(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{331:function(a,t,s){"use strict";s.r(t);var e=s(14),n=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"维护代码库及其授权"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#维护代码库及其授权"}},[a._v("#")]),a._v(" 维护代码库及其授权")]),a._v(" "),t("p",[a._v("在开始本节之前，请确保您已阅读 "),t("RouterLink",{attrs:{to:"/guide/user-guide/main-process.html"}},[a._v("主体流程")]),a._v(" 章节，了解执行流水线和部署应用的主体流程和相关术语。")],1),a._v(" "),t("p",[a._v("代码库是用于存储项目的源代码、流水线配置、部署清单的版本库。只支持 Git。")]),a._v(" "),t("p",[a._v("流水线运行时需要获取代码库中的源代码、流水线配置和其他相关文件，以实现项目集成。通过将代码库授权给产品或项目，可以让相关项目下的流水线运行时能够读写被授权代码库，从而推进项目集成。")]),a._v(" "),t("p",[a._v("与流水线运行时类似，部署运行时也需要从代码库中获取部署清单和其他相关文件, 并且使用相同的授权方式，以实现应用部署。")]),a._v(" "),t("p",[a._v("支持通过 "),t("RouterLink",{attrs:{to:"/guide/user-guide/deploy-an-application.html#初始化产品"}},[a._v("命令行")]),a._v(" 和 API 两种方式维护代码库和代码库授权。")],1),a._v(" "),t("h2",{attrs:{id:"前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[a._v("#")]),a._v(" 前提条件")]),a._v(" "),t("h3",{attrs:{id:"创建-access-token"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建-access-token"}},[a._v("#")]),a._v(" 创建 access token")]),a._v(" "),t("p",[a._v("您需要创建一个 access token，作为请求 API 的请求头。详情参考 "),t("RouterLink",{attrs:{to:"/guide/user-guide/product.html#创建-access-token"}},[a._v("创建 access token")]),a._v("。")],1),a._v(" "),t("h3",{attrs:{id:"导入证书"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#导入证书"}},[a._v("#")]),a._v(" 导入证书")]),a._v(" "),t("p",[a._v("在使用 HTTPS 协议访问 Nautes API Server 之前，请先"),t("RouterLink",{attrs:{to:"/guide/user-guide/run-a-pipeline.html#导入证书"}},[a._v("导入证书")]),a._v("。")],1),a._v(" "),t("h3",{attrs:{id:"创建产品"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建产品"}},[a._v("#")]),a._v(" 创建产品")]),a._v(" "),t("p",[a._v("由于代码库归属于产品，您需要创建至少一个"),t("RouterLink",{attrs:{to:"/guide/user-guide/product.html#创建产品api"}},[a._v("产品")]),a._v("。")],1),a._v(" "),t("h2",{attrs:{id:"创建和更新代码库-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建和更新代码库-api"}},[a._v("#")]),a._v(" 创建和更新代码库（API）")]),a._v(" "),t("h3",{attrs:{id:"生成创建-更新代码库-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成创建-更新代码库-api-请求"}},[a._v("#")]),a._v(" 生成创建/更新代码库 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepo_SaveCodeRepo")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $api-server-address 为 Nautes API Server 的访问地址")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $gitlab-access-token 为 GitLab 访问令牌")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $product-name 为代码库所属产品的名称")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $coderepo-name 为代码库名称")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepos/$coderepo-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                # 代码库关联的项目\n                "project": $project,\n                # 代码库的 webhook 事件\n                "webhook": {\n                    "events": ["push_events"]\n                },\n                # 是否用于部署运行时\n                "deployment_runtime": true,\n                "pipeline_runtime": false,\n                "git": {\n                    "gitlab": {\n                        # 代码库的名称\n                        "name": $coderepo-name,\n                        # 代码库的路径\n                        "path": $coderepo-name,\n                        # 代码库的可见性，例如：private、public \n                        "visibility": $coderepo-visibility,\n                        "description": $coderepo-desc\n                        }\n                    }\n            }\'')]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepos/api-server'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                "project": "api-server",\n                "webhook": {\n                    "events": ["push_events"]\n                },\n                "deployment_runtime": true,\n                "pipeline_runtime": false,\n                "git": {\n                    "gitlab": {\n                        "name": "api-server",\n                        "path": "api-server",\n                        "visibility": "private",\n                        "description": "Providing REST APIs for creating configuration declarations of environments."\n                        }\n                    }\n            }\'')]),a._v("\n")])])]),t("h3",{attrs:{id:"执行创建-更新代码库的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行创建-更新代码库的-api-请求"}},[a._v("#")]),a._v(" 执行创建/更新代码库的 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以新增代码库。")]),a._v(" "),t("p",[a._v("请求成功后，将在指定产品的 "),t("code",[a._v("default.project")]),a._v(" 代码库中生成代码库的资源文件，并创建代码库。代码库的资源文件示例如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nautes.resource.nautes.io/v1alpha1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" CodeRepo\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" repo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("xxxx\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("codeRepoProvider")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" gitlab\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("deploymentRuntime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("pipelineRuntime")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("product")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("xxxx\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("project")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("repoName")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" api"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("server\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("webhook")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("events")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" push_events\n")])])]),t("blockquote",[t("p",[a._v("请求 API 更新代码库也将更新代码库资源文件。")]),a._v(" "),t("p",[a._v("只有当您的账号是 GitLab 的 group 成员、具备创建代码库的权限、具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的 main 分支的写入权限，才可以创建或者更新代码库。")])]),a._v(" "),t("h2",{attrs:{id:"删除代码库-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除代码库-api"}},[a._v("#")]),a._v(" 删除代码库（API）")]),a._v(" "),t("blockquote",[t("p",[a._v("在删除代码库之前，请先删除与代码库关联的所有实体和资源，例如：部署运行时等，否则将不能执行删除。")])]),a._v(" "),t("h3",{attrs:{id:"生成删除代码库的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成删除代码库的-api-请求"}},[a._v("#")]),a._v(" 生成删除代码库的 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepo_DeleteCodeRepo")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'DELETE'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepos/$coderepo-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v(" \n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'DELETE'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepos/api-server'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" \n")])])]),t("h3",{attrs:{id:"执行删除代码库的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行删除代码库的-api-请求"}},[a._v("#")]),a._v(" 执行删除代码库的 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以删除代码库。")]),a._v(" "),t("p",[a._v("请求成功后，将删除代码库，以及在指定产品的 "),t("code",[a._v("default.project")]),a._v("代码库中的代码库资源文件。")]),a._v(" "),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员、具备删除代码库的权限、具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的 main 分支的写入权限，才可以删除代码库。")])]),a._v(" "),t("h2",{attrs:{id:"查询代码库列表-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询代码库列表-api"}},[a._v("#")]),a._v(" 查询代码库列表（API）")]),a._v(" "),t("h3",{attrs:{id:"生成查询代码库列表的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成查询代码库列表的-api-请求"}},[a._v("#")]),a._v(" 生成查询代码库列表的 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepo_ListCodeRepos")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepos'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v(" \n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepos'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" \n")])])]),t("h3",{attrs:{id:"执行查询代码库列表的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行查询代码库列表的-api-请求"}},[a._v("#")]),a._v(" 执行查询代码库列表的 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以查询代码库列表。代码库列表的返回值示例如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"items"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"product"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nautes-labs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"api-server"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"project"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"api-server"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"webhook"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"events"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"push_events"')]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"deployment_runtime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("true")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"pipeline_runtime"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"gitlab"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"api-server"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"path"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"api-server"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"visibility"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"private"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"description"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"Providing REST APIs for creating configuration declarations of environments."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"ssh_url_to_repo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"ssh://git@github.com:nautes-labs/api-server.git"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n                    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"http_url_to_repo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"https://github.com/nautes-labs/api-server.git"')]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员、具备查询代码库的权限、具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的读取权限，才可以查询代码库列表。")])]),a._v(" "),t("h2",{attrs:{id:"查询代码库详情-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询代码库详情-api"}},[a._v("#")]),a._v(" 查询代码库详情（API）")]),a._v(" "),t("h3",{attrs:{id:"生成查看代码库详情的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成查看代码库详情的-api-请求"}},[a._v("#")]),a._v(" 生成查看代码库详情的 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepo_GetCodeRepo")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepos/$coderepo-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepos/api-server'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v("\n")])])]),t("h3",{attrs:{id:"执行查看代码库详情的-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行查看代码库详情的-api-请求"}},[a._v("#")]),a._v(" 执行查看代码库详情的 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以查询代码库详情。代码库详情的返回值示例与"),t("a",{attrs:{href:"#%E6%9F%A5%E8%AF%A2%E4%BB%A3%E7%A0%81%E5%BA%93%E5%88%97%E8%A1%A8api"}},[a._v("查询代码库列表")]),a._v("类似。")]),a._v(" "),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员、具备查询代码库的权限、具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的读取权限，才可以查看代码库详情。")])]),a._v(" "),t("h2",{attrs:{id:"强制创建-更新-删除代码库-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强制创建-更新-删除代码库-api"}},[a._v("#")]),a._v(" 强制创建/更新/删除代码库（API）")]),a._v(" "),t("p",[a._v("适用于需要跳过 API 校验的特殊场景，详情参见"),t("RouterLink",{attrs:{to:"/guide/user-guide/main-process.html#初始化产品"}},[a._v("初始化产品")]),a._v("。")],1),a._v(" "),t("p",[a._v("以创建代码库为例，将 project 属性设置为不存在的 project，启用 "),t("code",[a._v("insecure_skip_check")]),a._v(" 查询参数，可以强制提交代码库的资源文件。 请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepos/coderepo-demo?insecure_skip_check=true'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                "project": "project-demo-invalid",\n                "webhook": {\n                    "events": [\n                        "push_events"\n                    ]\n                },\n                "deployment_runtime": true,\n                "pipeline_runtime": false,\n                "git": {\n                    "gitlab": {\n                        "name": "coderepo-demo",\n                        "path": "coderepo-demo",\n                        "visibility": "private",\n                        "description": "This is a code repository for testing purposes."\n                    }\n                }\n            }\'')]),a._v("\n")])])]),t("h2",{attrs:{id:"创建和更新代码库授权-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#创建和更新代码库授权-api"}},[a._v("#")]),a._v(" 创建和更新代码库授权（API）")]),a._v(" "),t("h3",{attrs:{id:"生成创建-更新代码库授权-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成创建-更新代码库授权-api-请求"}},[a._v("#")]),a._v(" 生成创建/更新代码库授权 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepoBinding_SaveCodeRepoBinding")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $api-server-address 为 Nautes API Server 的访问地址")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $gitlab-access-token 为 GitLab 访问令牌")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $product-name 为被授权代码库所属产品的名称")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("# 替换变量 $coderepo-binding-name 为代码库授权的名称")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-addresss/api/v1/products/$product-name/coderepobindings/$coderepo-binding-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                # 授权产品：目前只支持将代码库授权给其所属的产品，与 $product-name 的值相同\n                "product": "$authorized-product-name",\n                # 授权项目：如果为空，将代码库授权给产品； 如果不为空，将代码库授权给产品内的指定项目\n                "projects": [\n                    "$project-name"\n                ],\n                # 权限：readwrite 或 readonly\n                "permissions": "$permissions",\n                # 授权代码库的名称\n                "coderepo": "$coderepo-name"\n            }\'')]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepobindings/coderepo-binding-vault-proxy'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                "product": "nautes-labs",\n                "projects": [\n                    "argo-operator"\n                ],\n                "permissions": "readonly",\n                "coderepo": "vault-proxy"\n            }\'')]),a._v("\n")])])]),t("h3",{attrs:{id:"执行创建-更新代码库授权-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行创建-更新代码库授权-api-请求"}},[a._v("#")]),a._v(" 执行创建/更新代码库授权 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以新增代码库授权。")]),a._v(" "),t("p",[a._v("请求成功后，将在指定产品的 "),t("code",[a._v("default.project")]),a._v(" 代码库中生成代码库授权的资源文件，并在被授权代码库的 deploy key 列表中添加授权产品或项目的关联代码库的 deploy key。代码库授权的资源文件示例如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("apiVersion")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" nautes.resource.nautes.io/v1alpha1\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("kind")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" CodeRepoBinding\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("metadata")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" coderepo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("binding"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("vault"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("proxy\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("spec")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("coderepo")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" repo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("xxxx\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("permissions")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" readonly\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("product")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" product"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("xxxx\n        "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("projects")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v(" argo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("-")]),a._v("operator\n")])])]),t("blockquote",[t("p",[a._v("请求 API 更新代码库授权也将更新代码库授权的资源文件。")]),a._v(" "),t("p",[a._v("只有当您的账号是 GitLab 的 group 成员且拥有 Maintainer 或更高级别的角色，并具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的 main 分支的写入权限，才可以创建或者更新代码库授权。")]),a._v(" "),t("p",[a._v("您可以为一个代码库创建多个代码库授权的资源文件。例如：您可以创建两份资源文件，一份授权给产品、另一份授权给项目，或者将两份资源文件分别授权给不同的项目。代码库的授权范围将由产品和项目授权的并集决定。")]),a._v(" "),t("p",[a._v("代码库授权成功后，如果您需要更新授权产品或项目相关联的代码库，例如：新增或删除关联的代码库，被授权代码库的 deploy key 列表将自动更新以反映相应代码库的变更。")]),a._v(" "),t("p",[a._v("代码库授权的资源文件创建成功后，不能变更 "),t("code",[a._v("coderepo")]),a._v(" 的属性值，如果您需要变更被授权的代码库，请先"),t("a",{attrs:{href:"#%E5%88%A0%E9%99%A4%E4%BB%A3%E7%A0%81%E5%BA%93%E6%8E%88%E6%9D%83api"}},[a._v("删除代码库授权")]),a._v("再重新授权。")])]),a._v(" "),t("h2",{attrs:{id:"删除代码库授权-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除代码库授权-api"}},[a._v("#")]),a._v(" 删除代码库授权（API）")]),a._v(" "),t("h3",{attrs:{id:"生成删除代码库授权-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成删除代码库授权-api-请求"}},[a._v("#")]),a._v(" 生成删除代码库授权 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepoBinding_DeleteCodeRepoBinding")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'DELETE'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepobindings/$coderepo-binding-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'DELETE'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepobindings/coderepo-binding-vault-proxy'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v("\n")])])]),t("h3",{attrs:{id:"执行删除代码库授权-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行删除代码库授权-api-请求"}},[a._v("#")]),a._v(" 执行删除代码库授权 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以删除代码库授权。")]),a._v(" "),t("p",[a._v("请求成功后，将在指定产品的 "),t("code",[a._v("default.project")]),a._v("代码库中删除相应的代码库授权资源文件，并重新计算代码库的授权范围，根据计算结果进一步更新被授权代码库的 deploy key 列表。")]),a._v(" "),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员且拥有 Maintainer 或更高级别的角色，并具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的 main 分支的写入权限，才可以删除代码库授权。")])]),a._v(" "),t("h2",{attrs:{id:"查询代码库授权列表-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查询代码库授权列表-api"}},[a._v("#")]),a._v(" 查询代码库授权列表（API）")]),a._v(" "),t("h3",{attrs:{id:"生成查询代码库授权列表-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成查询代码库授权列表-api-请求"}},[a._v("#")]),a._v(" 生成查询代码库授权列表 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepoBinding_ListCodeRepoBindings")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepobindings'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepobindings'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v("\n")])])]),t("h3",{attrs:{id:"执行查询代码库授权列表-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行查询代码库授权列表-api-请求"}},[a._v("#")]),a._v(" 执行查询代码库授权列表 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以查询代码库授权列表。代码库授权列表的返回值示例如下：")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"items"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"product"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"nautes-labs"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"name"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"coderepo-binding-vault-proxy"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"projects"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("[")]),a._v("\n                "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"argo-operator"')]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"permissions"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"readonly"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n            "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v('"coderepo"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"vault-proxy"')]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("]")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员，并具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的读取权限，才可以查询代码库授权列表。")])]),a._v(" "),t("h2",{attrs:{id:"查看代码库授权详情-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看代码库授权详情-api"}},[a._v("#")]),a._v(" 查看代码库授权详情（API）")]),a._v(" "),t("h3",{attrs:{id:"生成查看代码库授权详情-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#生成查看代码库授权详情-api-请求"}},[a._v("#")]),a._v(" 生成查看代码库授权详情 API 请求")]),a._v(" "),t("p",[a._v("通过接口定义 "),t("code",[a._v("CodeRepoBinding_GetCodeRepoBinding")]),a._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://$api-server-address/api/v1/products/$product-name/coderepobindings/$coderepo-binding-name'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer $gitlab-access-token'")]),a._v("\n")])])]),t("p",[a._v("替换变量后的请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'GET'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepobindings/coderepo-binding-vault-proxy'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v("\n")])])]),t("h3",{attrs:{id:"执行查看代码库授权详情-api-请求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行查看代码库授权详情-api-请求"}},[a._v("#")]),a._v(" 执行查看代码库授权详情 API 请求")]),a._v(" "),t("p",[a._v("使用 curl 命令或者其他工具执行 API 请求，以查询代码库授权详情。代码库授权详情的返回值示例与"),t("a",{attrs:{href:"#%E6%9F%A5%E8%AF%A2%E4%BB%A3%E7%A0%81%E5%BA%93%E6%8E%88%E6%9D%83%E5%88%97%E8%A1%A8api"}},[a._v("查询代码库授权列表")]),a._v("类似。")]),a._v(" "),t("blockquote",[t("p",[a._v("只有当您的账号是 GitLab 的 group 成员，并具备对 "),t("code",[a._v("default.project")]),a._v(" 代码库的读取权限，才可以查看代码库授权详情。")])]),a._v(" "),t("h2",{attrs:{id:"强制创建-更新-删除代码库授权-api"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#强制创建-更新-删除代码库授权-api"}},[a._v("#")]),a._v(" 强制创建/更新/删除代码库授权（API）")]),a._v(" "),t("p",[a._v("适用于需要跳过 API 校验的特殊场景，详情参见"),t("RouterLink",{attrs:{to:"/guide/user-guide/main-process.html#初始化产品"}},[a._v("初始化产品")]),a._v("。")],1),a._v(" "),t("p",[a._v("以创建代码库授权为例，将 project 属性设置为不存在的 project，启用 "),t("code",[a._v("insecure_skip_check")]),a._v(" 查询参数，可以强制提交代码库授权的资源文件。 请求示例如下：")]),a._v(" "),t("div",{staticClass:"language-Shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("    "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-X")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'POST'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/products/nautes-labs/coderepobindings/coderepo-binding-vault-proxy?insecure_skip_check=true'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'accept: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Content-Type: application/json'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-H")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n        "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-d")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{\n                "product": "nautes-labs",\n                "projects": [\n                    "project-invalid"\n                ],\n                "permissions": "readonly",\n                "coderepo": "vault-proxy"\n            }\'')]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);