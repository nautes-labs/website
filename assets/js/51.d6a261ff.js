(window.webpackJsonp=window.webpackJsonp||[]).push([[51],{330:function(t,a,e){"use strict";e.r(a);var s=e(14),n=Object(s.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"注册运行时集群"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册运行时集群"}},[t._v("#")]),t._v(" 注册运行时集群")]),t._v(" "),a("p",[t._v("在开始本节之前，请确保您已阅读 "),a("RouterLink",{attrs:{to:"/guide/user-guide/main-process.html"}},[t._v("主体流程")]),t._v(" 章节，了解执行流水线和部署应用的主体流程和相关术语。")],1),t._v(" "),a("p",[t._v("运行时集群用于承载应用的运行时。集群形态支持物理集群和虚拟集群。")]),t._v(" "),a("p",[t._v("支持通过 "),a("RouterLink",{attrs:{to:"/guide/user-guide/run-a-pipeline.html#注册运行时集群"}},[t._v("命令行")]),t._v(" 和 API 两种方式注册运行时集群。")],1),t._v(" "),a("h2",{attrs:{id:"前提条件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[t._v("#")]),t._v(" 前提条件")]),t._v(" "),a("h3",{attrs:{id:"创建-access-token"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-access-token"}},[t._v("#")]),t._v(" 创建 access token")]),t._v(" "),a("p",[t._v("您需要创建一个 access token，作为请求 API 的请求头。详情参考 "),a("RouterLink",{attrs:{to:"/guide/user-guide/run-a-pipeline.html#注册-gitlab-账号"}},[t._v("注册 GitLab 账号")]),t._v("。")],1),t._v(" "),a("h3",{attrs:{id:"导入证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#导入证书"}},[t._v("#")]),t._v(" 导入证书")]),t._v(" "),a("p",[t._v("如果您想使用 https 协议访问 Nautes API Server，请"),a("RouterLink",{attrs:{to:"/guide/user-guide/run-a-pipeline.html#导入证书"}},[t._v("导入证书")]),t._v("。")],1),t._v(" "),a("h2",{attrs:{id:"注册物理集群-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册物理集群-api"}},[t._v("#")]),t._v(" 注册物理集群（API）")]),t._v(" "),a("h3",{attrs:{id:"生成注册物理集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成注册物理集群的-api-请求"}},[t._v("#")]),t._v(" 生成注册物理集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_SaveCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $api-server-address 为 Nautes API Server 的访问地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $gitlab-access-token 为 GitLab access token")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $cluster-name 为集群名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://$api-server-address/api/v1/clusters/$cluster-name'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer $gitlab-access-token'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                # 集群的 API SERVER URL。使用物理集群的 server 地址替换该变量\n                "api_server": $api-server,\n                # 集群种类：目前只支持 kubernetes\n                "cluster_kind": "kubernetes",\n                # 集群类型：virtual 或 physical\n                "cluster_type": $cluster-type,\n                # 集群用途：host 或 worker\n                "usage": $usage,\n                # 运行时类型：pipeline（流水线运行时）或者 deployment（部署运行时）\n                "worker_type": $worker-type,\n                # 主域名，使用物理集群的 IP 替换变量 $cluster-ip\n                "primary_domain": "$cluster-ip.nip.io",\n                # tekton 域名：当 worker_type 是 pipeline 时才需要填写该属性，使用物理集群的 IP 替换变量 $cluster-ip\n                "tekton_host": "tekton.$cluster-name.$cluster-ip.nip.io",\n                # argocd 域名：使用物理集群的 IP 替换变量 $cluster-ip\n                "argocd_host": "argocd.$cluster-name.$cluster-ip.nip.io",\n                # traefik 配置\n                "traefik": {\n                  "http_node_port": "30080",\n                  "https_node_port": "30443"\n                },\n                # 集群的 kubeconfig 文件内容：使用物理集群的 kubeconfig 替换该变量，并且 kubeconfig 需要转义换行符\n                "kubeconfig": $kubeconfig\n            }\'')]),t._v("\n")])])]),a("p",[t._v("替换变量后流水线运行时集群的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/physical-worker-pipeline'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxxxxxxxx'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                "api_server": "https://8.217.50.114:6443",\n                "cluster_kind": "kubernetes",\n                "cluster_type": "physical",\n                "usage": "worker",\n                "worker_type": "pipeline",\n                "primary_domain": "8.217.50.114.nip.io",\n                "tekton_host": "tekton.physical-worker-pipeline.8.217.50.114.nip.io",\n                "argocd_host": "argocd.physical-worker-pipeline.8.217.50.114.nip.io",\n                "traefik": {\n                  "http_node_port": "30080",\n                  "https_node_port": "30443"\n                },\n                "kubeconfig": "apiVersion: v1\\nclusters:\\n- cluster:\\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFRdnRkRTdSVW1BSHYxOHdEWDF2L2pucWFFU3NmcjduUm5wbTViYjZ0NmEKRDZmZHg0NnVRYitDYWFjVXJUMVVycTVOSTJNTHhHSC8yS0xBL2Y0T2V4WjRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVW13L1FHSXc1N2VtQjhnaDhwQVpGCmdrVG1sQzB3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnU0FCZDdMdEVxYnY3Q0pqQ2VHa1ljL1ZqUkh3NnNTSkUKMHJFV3ZyVFFoSFlDSUJoZXpPOXRTVVpxV3dlVGk1SFZTUEhYNnRmR2E0SkpkTlNuN01ma0RMZnMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\\n    server: https://10.204.118.23:6443\\n  name: default\\ncontexts:\\n- context:\\n    cluster: default\\n    user: default\\n  name: default\\ncurrent-context: default\\nkind: Config\\npreferences: {}\\nusers:\\n- name: default\\n  user:\\n    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrRENDQVRlZ0F3SUJBZ0lJT0MvTUZodzFVSXd3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOamcyTVRRd05EYzBNQjRYRFRJek1EWXdOekV5TWpFeE5Gb1hEVEkwTURZdwpOakV5TWpFeE5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJDdmFlak9Yc09NVWtsd1oKU25nL1dXTy9zTE5XRG9rMzF3Z3A4ditVVWZ6b25SRGtGRzRJK3RYNXpwYUF6TXlsZndmWWc2aUZ1RmkzaWRkKwpQRlpod0d1alNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCUStpcXZQYVQxRW5qZVA0SlhqWkxSYWd1NnRzVEFLQmdncWhrak9QUVFEQWdOSEFEQkUKQWlCMVFtQ2NyRHZGSUxVMUl3K01laURkZERMQkhoQVdhOUJ1T3NCRFZLU0F5Z0lnSEgyOVF5UDg1aEZQUkd6dQpQZENjdjdVN01NL2lpOG5zbGQrTy8ySW8yYnc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFReXM3c3JZWEFFczBPa2lqWkt0R1hEZk1HWlhzMGJySGx4T1dwRGZ0d2cKK2xFMGRaNFJ4U1hYVWhCNEo0ZjB0ZUhXRk5NVmU3c1pjN2kyNTAwbWVoUUVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVBvcXJ6Mms5Uko0M2orQ1Y0MlMwCldvTHVyYkV3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUxjQlllRGFEMTc0YVpaUU1CQm53NHAvNmY5S1hVb2YKM2tpRFFXNUNLTWgzQWlCdWFPR252Yml2ajRDeHJPckgxWEZSUS9VR2tXYmtGWEUweExWc1VJZmprQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUZ6TDY2TDZMWGkvM3IzUEdFYTRMUmxlUXoybGUwU0R4cFdPV1dMRzZIamhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFSzlwNk01ZXc0eFNTWEJsS2VEOVpZNyt3czFZT2lUZlhDQ255LzVSUi9PaWRFT1FVYmdqNgoxZm5PbG9ETXpLVi9COWlEcUlXNFdMZUoxMzQ4Vm1IQWF3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="\n            }\'')]),t._v("\n")])])]),a("p",[t._v("替换变量后部署运行时集群的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/physical-worker-deployment'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxxxxxxxx'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                "api_server": "https://8.217.50.114:6443",\n                "cluster_kind": "kubernetes",\n                "cluster_type": "physical",\n                "usage": "worker",\n                "worker_type": "deployment",\n                "primary_domain": "8.217.50.114.nip.io",\n                "argocd_host": "argocd.physical-worker-deployment.8.217.50.114.nip.io",\n                "traefik": {\n                  "http_node_port": "30080",\n                  "https_node_port": "30443"\n                },\n                "kubeconfig": "apiVersion: v1\\nclusters:\\n- cluster:\\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFRdnRkRTdSVW1BSHYxOHdEWDF2L2pucWFFU3NmcjduUm5wbTViYjZ0NmEKRDZmZHg0NnVRYitDYWFjVXJUMVVycTVOSTJNTHhHSC8yS0xBL2Y0T2V4WjRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVW13L1FHSXc1N2VtQjhnaDhwQVpGCmdrVG1sQzB3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnU0FCZDdMdEVxYnY3Q0pqQ2VHa1ljL1ZqUkh3NnNTSkUKMHJFV3ZyVFFoSFlDSUJoZXpPOXRTVVpxV3dlVGk1SFZTUEhYNnRmR2E0SkpkTlNuN01ma0RMZnMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\\n    server: https://10.204.118.23:6443\\n  name: default\\ncontexts:\\n- context:\\n    cluster: default\\n    user: default\\n  name: default\\ncurrent-context: default\\nkind: Config\\npreferences: {}\\nusers:\\n- name: default\\n  user:\\n    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrRENDQVRlZ0F3SUJBZ0lJT0MvTUZodzFVSXd3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOamcyTVRRd05EYzBNQjRYRFRJek1EWXdOekV5TWpFeE5Gb1hEVEkwTURZdwpOakV5TWpFeE5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJDdmFlak9Yc09NVWtsd1oKU25nL1dXTy9zTE5XRG9rMzF3Z3A4ditVVWZ6b25SRGtGRzRJK3RYNXpwYUF6TXlsZndmWWc2aUZ1RmkzaWRkKwpQRlpod0d1alNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCUStpcXZQYVQxRW5qZVA0SlhqWkxSYWd1NnRzVEFLQmdncWhrak9QUVFEQWdOSEFEQkUKQWlCMVFtQ2NyRHZGSUxVMUl3K01laURkZERMQkhoQVdhOUJ1T3NCRFZLU0F5Z0lnSEgyOVF5UDg1aEZQUkd6dQpQZENjdjdVN01NL2lpOG5zbGQrTy8ySW8yYnc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFReXM3c3JZWEFFczBPa2lqWkt0R1hEZk1HWlhzMGJySGx4T1dwRGZ0d2cKK2xFMGRaNFJ4U1hYVWhCNEo0ZjB0ZUhXRk5NVmU3c1pjN2kyNTAwbWVoUUVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVBvcXJ6Mms5Uko0M2orQ1Y0MlMwCldvTHVyYkV3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUxjQlllRGFEMTc0YVpaUU1CQm53NHAvNmY5S1hVb2YKM2tpRFFXNUNLTWgzQWlCdWFPR252Yml2ajRDeHJPckgxWEZSUS9VR2tXYmtGWEUweExWc1VJZmprQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUZ6TDY2TDZMWGkvM3IzUEdFYTRMUmxlUXoybGUwU0R4cFdPV1dMRzZIamhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFSzlwNk01ZXc0eFNTWEJsS2VEOVpZNyt3czFZT2lUZlhDQ255LzVSUi9PaWRFT1FVYmdqNgoxZm5PbG9ETXpLVi9COWlEcUlXNFdMZUoxMzQ4Vm1IQWF3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="\n            }\'')]),t._v("\n")])])]),a("h3",{attrs:{id:"执行注册物理集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行注册物理集群的-api-请求"}},[t._v("#")]),t._v(" 执行注册物理集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求，以注册物理集群。")]),t._v(" "),a("p",[t._v("请求成功后，将向租户配置库写入物理集群的资源文件，并根据资源文件向租户管理集群注册物理集群作为运行时集群。注册成功后，将在物理集群中安装 ArgoCD、ArgoRollouts、Tekton、ExternalSecret、HNC、Vault-agent 等组件。")]),t._v(" "),a("blockquote",[a("p",[t._v("只有当您的账号是租户配置库的成员，并且具备 main 分支的写入权限，才可以注册运行时集群。")])]),t._v(" "),a("h2",{attrs:{id:"注册虚拟集群-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册虚拟集群-api"}},[t._v("#")]),t._v(" 注册虚拟集群（API）")]),t._v(" "),a("p",[t._v("注册虚拟集群时需要先将物理集群注册为宿主集群，再在宿主集群上注册虚拟集群。")]),t._v(" "),a("h3",{attrs:{id:"生成注册宿主集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成注册宿主集群的-api-请求"}},[t._v("#")]),t._v(" 生成注册宿主集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_SaveCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $api-server-address 为 Nautes API Server 的访问地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $gitlab-access-token 为 GitLab access token")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $cluster-name 为集群名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://$api-server-address/api/v1/clusters/$cluster-name'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer $gitlab-access-token'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                # 集群的 API SERVER URL，使用宿主集群的 server 地址替换该变量\n                "api_server": $api-server,\n                # 集群种类：目前只支持 kubernetes\n                "cluster_kind": "kubernetes",\n                # 集群类型：virtual 或 physical\n                "cluster_type": $cluster-type,\n                # 集群用途：host 或 worker\n                "usage": $usage,\n                # 主域名，使用物理集群的 IP 替换变量 $cluster-ip\n                "primary_domain": "$cluster-ip.nip.io",\n                # traefik 配置\n                "traefik": {\n                  "http_node_port": "30080",\n                  "https_node_port": "30443"\n                },\n                # 集群的 kubeconfig 文件内容，使用宿主集群的 kubeconfig 替换该变量，并且 kubeconfig 需要转义换行符\n                "kubeconfig": $kubeconfig\n            }\'')]),t._v("\n")])])]),a("p",[t._v("替换变量后的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/cluster-host'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxxxxxxxx'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                "api_server": "https://8.217.50.114:6443",\n                "cluster_kind": "kubernetes",\n                "cluster_type": "physical",\n                "usage": "host",\n                "primary_domain": "8.217.50.114.nip.io",\n                "traefik": {\n                  "http_node_port": "30080",\n                  "https_node_port": "30443"\n                },\n                "kubeconfig": "apiVersion: v1\\nclusters:\\n- cluster:\\n    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkakNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdGMyVnkKZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRjMlZ5ZG1WeUxXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFRdnRkRTdSVW1BSHYxOHdEWDF2L2pucWFFU3NmcjduUm5wbTViYjZ0NmEKRDZmZHg0NnVRYitDYWFjVXJUMVVycTVOSTJNTHhHSC8yS0xBL2Y0T2V4WjRvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVW13L1FHSXc1N2VtQjhnaDhwQVpGCmdrVG1sQzB3Q2dZSUtvWkl6ajBFQXdJRFJ3QXdSQUlnU0FCZDdMdEVxYnY3Q0pqQ2VHa1ljL1ZqUkh3NnNTSkUKMHJFV3ZyVFFoSFlDSUJoZXpPOXRTVVpxV3dlVGk1SFZTUEhYNnRmR2E0SkpkTlNuN01ma0RMZnMKLS0tLS1FTkQgQ0VSVElGSUNBVEUtLS0tLQo=\\n    server: https://10.204.118.23:6443\\n  name: default\\ncontexts:\\n- context:\\n    cluster: default\\n    user: default\\n  name: default\\ncurrent-context: default\\nkind: Config\\npreferences: {}\\nusers:\\n- name: default\\n  user:\\n    client-certificate-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJrRENDQVRlZ0F3SUJBZ0lJT0MvTUZodzFVSXd3Q2dZSUtvWkl6ajBFQXdJd0l6RWhNQjhHQTFVRUF3d1kKYXpOekxXTnNhV1Z1ZEMxallVQXhOamcyTVRRd05EYzBNQjRYRFRJek1EWXdOekV5TWpFeE5Gb1hEVEkwTURZdwpOakV5TWpFeE5Gb3dNREVYTUJVR0ExVUVDaE1PYzNsemRHVnRPbTFoYzNSbGNuTXhGVEFUQmdOVkJBTVRESE41CmMzUmxiVHBoWkcxcGJqQlpNQk1HQnlxR1NNNDlBZ0VHQ0NxR1NNNDlBd0VIQTBJQUJDdmFlak9Yc09NVWtsd1oKU25nL1dXTy9zTE5XRG9rMzF3Z3A4ditVVWZ6b25SRGtGRzRJK3RYNXpwYUF6TXlsZndmWWc2aUZ1RmkzaWRkKwpQRlpod0d1alNEQkdNQTRHQTFVZER3RUIvd1FFQXdJRm9EQVRCZ05WSFNVRUREQUtCZ2dyQmdFRkJRY0RBakFmCkJnTlZIU01FR0RBV2dCUStpcXZQYVQxRW5qZVA0SlhqWkxSYWd1NnRzVEFLQmdncWhrak9QUVFEQWdOSEFEQkUKQWlCMVFtQ2NyRHZGSUxVMUl3K01laURkZERMQkhoQVdhOUJ1T3NCRFZLU0F5Z0lnSEgyOVF5UDg1aEZQUkd6dQpQZENjdjdVN01NL2lpOG5zbGQrTy8ySW8yYnc9Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0KLS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSUJkekNDQVIyZ0F3SUJBZ0lCQURBS0JnZ3Foa2pPUFFRREFqQWpNU0V3SHdZRFZRUUREQmhyTTNNdFkyeHAKWlc1MExXTmhRREUyT0RZeE5EQTBOelF3SGhjTk1qTXdOakEzTVRJeU1URTBXaGNOTXpNd05qQTBNVEl5TVRFMApXakFqTVNFd0h3WURWUVFEREJock0zTXRZMnhwWlc1MExXTmhRREUyT0RZeE5EQTBOelF3V1RBVEJnY3Foa2pPClBRSUJCZ2dxaGtqT1BRTUJCd05DQUFReXM3c3JZWEFFczBPa2lqWkt0R1hEZk1HWlhzMGJySGx4T1dwRGZ0d2cKK2xFMGRaNFJ4U1hYVWhCNEo0ZjB0ZUhXRk5NVmU3c1pjN2kyNTAwbWVoUUVvMEl3UURBT0JnTlZIUThCQWY4RQpCQU1DQXFRd0R3WURWUjBUQVFIL0JBVXdBd0VCL3pBZEJnTlZIUTRFRmdRVVBvcXJ6Mms5Uko0M2orQ1Y0MlMwCldvTHVyYkV3Q2dZSUtvWkl6ajBFQXdJRFNBQXdSUUloQUxjQlllRGFEMTc0YVpaUU1CQm53NHAvNmY5S1hVb2YKM2tpRFFXNUNLTWgzQWlCdWFPR252Yml2ajRDeHJPckgxWEZSUS9VR2tXYmtGWEUweExWc1VJZmprQT09Ci0tLS0tRU5EIENFUlRJRklDQVRFLS0tLS0K\\n    client-key-data: LS0tLS1CRUdJTiBFQyBQUklWQVRFIEtFWS0tLS0tCk1IY0NBUUVFSUZ6TDY2TDZMWGkvM3IzUEdFYTRMUmxlUXoybGUwU0R4cFdPV1dMRzZIamhvQW9HQ0NxR1NNNDkKQXdFSG9VUURRZ0FFSzlwNk01ZXc0eFNTWEJsS2VEOVpZNyt3czFZT2lUZlhDQ255LzVSUi9PaWRFT1FVYmdqNgoxZm5PbG9ETXpLVi9COWlEcUlXNFdMZUoxMzQ4Vm1IQWF3PT0KLS0tLS1FTkQgRUMgUFJJVkFURSBLRVktLS0tLQo="\n            }\'')]),t._v("\n")])])]),a("h3",{attrs:{id:"执行注册宿主集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行注册宿主集群的-api-请求"}},[t._v("#")]),t._v(" 执行注册宿主集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求，以注册宿主集群。")]),t._v(" "),a("p",[t._v("请求成功后，将向租户配置库写入宿主集群的资源文件，并根据资源文件向租户管理集群注册宿主集群。注册成功后，将在宿主集群中安装 Traefik 等组件。")]),t._v(" "),a("h3",{attrs:{id:"生成注册虚拟集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成注册虚拟集群的-api-请求"}},[t._v("#")]),t._v(" 生成注册虚拟集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_SaveCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $api-server-address 为 Nautes API Server 的访问地址")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $gitlab-access-token 为 GitLab access token")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 替换变量 $cluster-name 为集群名称")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://$api-server-address/api/v1/clusters/$cluster-name'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer $gitlab-access-token'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                # 集群的 API SERVER URL，使用 https://$hostcluster-ip:$api-server-port 格式替换参数，\n                # 其中 $hostcluster-ip 指宿主集群的IP，$api-server-port 指虚拟集群的 API Server 端口\n                "api_server": $api-server,\n                # 集群种类：目前只支持 kubernetes\n                "cluster_kind": "kubernetes",\n                # 集群类型：virtual 或 physical\n                "cluster_type": $cluster-type,\n                # 集群用途：host 或 worker\n                "usage": $usage,\n                # 运行时类型：pipeline（流水线运行时）或者 deployment（部署运行时）\n                "worker_type": $worker_type,\n                # 所属宿主集群：virtual 类型集群才有此属性，使用宿主集群的名称替换参数\n                "host_cluster": $host-cluster,\n                # 主域名，使用宿主集群的 IP 替换变量 $cluster-ip\n                "primary_domain": "$cluster-ip.nip.io",\n                # tekton 域名：当 worker_type 是 pipeline 时才需要填写该属性，使用物理集群的 IP 替换变量 $cluster-ip\n                "tekton_host": "tekton.$cluster-name.$cluster-ip.nip.io",\n                # argocd 域名：使用物理集群的 IP 替换变量 $cluster-ip\n                "argocd_host": "argocd.$cluster-name.$cluster-ip.nip.io",\n                # 虚拟集群配置：virtual 类型集群才有此属性\n                "vcluster": {\n                  # API SERVER 端口号\n                  "https_node_port": $api-server-port,\n                }\n            }\'')]),t._v("\n")])])]),a("p",[t._v("替换变量后的流水线运行时集群的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/virtual-worker-pipeline'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxxxxxxxx'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                "api_server": "https://8.217.50.114:31456",\n                "cluster_kind": "kubernetes",\n                "cluster_type": "virtual",\n                "usage": "worker",\n                "worker_type": "pipeline",\n                "host_cluster": "cluster-host",\n                "primary_domain": "8.217.50.114.nip.io",\n                "teoken_host": "tekton.virtual-worker-pipeline.8.217.50.114.nip.io",\n                "argocd_host": "argocd.virtual-worker-pipeline.8.217.50.114.nip.io",\n                "vcluster": {\n                  "https_node_port": "31456"\n                }\n            }\'')]),t._v("\n")])])]),a("p",[t._v("替换变量后的部署运行时集群的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'POST'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/virtual-worker-deployment'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Content-Type: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxxxxxxxx'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-d")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('\'{\n                "api_server": "https://8.217.50.114:31456",\n                "cluster_kind": "kubernetes",\n                "cluster_type": "virtual",\n                "usage": "worker",\n                "worker_type": "deployment",\n                "host_cluster": "cluster-host",\n                "primary_domain": "8.217.50.114.nip.io",\n                "argocd_host": "argocd.virtual-worker-deployment.8.217.50.114.nip.io",\n                "vcluster": {\n                  "https_node_port": "31456"\n                }\n            }\'')]),t._v("\n")])])]),a("h3",{attrs:{id:"执行注册虚拟集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行注册虚拟集群的-api-请求"}},[t._v("#")]),t._v(" 执行注册虚拟集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求，以注册虚拟集群。")]),t._v(" "),a("p",[t._v("请求成功后，将向租户配置库写入虚拟集群的资源文件，并根据资源文件向租户管理集群注册虚拟集群作为运行时集群。注册成功后，将在虚拟集群中安装 ArgoCD、ArgoRollouts、Tekton、ExternalSecret、HNC、Vault-agent 等组件。")]),t._v(" "),a("blockquote",[a("p",[t._v("只有当您的账号是租户配置库的成员，并且具备 main 分支的写入权限，才可以注册运行时集群。")])]),t._v(" "),a("h2",{attrs:{id:"删除物理集群-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除物理集群-api"}},[t._v("#")]),t._v(" 删除物理集群（API）")]),t._v(" "),a("blockquote",[a("p",[t._v("请确保已成功注册物理集群。")]),t._v(" "),a("p",[t._v("在删除集群之前请先删除产品配置清单。详情参考 "),a("RouterLink",{attrs:{to:"/guide/user-guide/clean-environment.html#删除运行时"}},[t._v("删除运行时(命令行)")]),t._v("，或者参考"),a("RouterLink",{attrs:{to:"/guide/user-guide/deployment-runtime.html#删除部署运行时api"}},[t._v("删除部署运行时")]),t._v("、"),a("RouterLink",{attrs:{to:"/guide/user-guide/project-pipeline-runtime.html#删除流水线运行时api"}},[t._v("删除流水线运行时")]),t._v("、"),a("RouterLink",{attrs:{to:"/guide/user-guide/environment.html#删除环境api"}},[t._v("删除环境")]),t._v("、"),a("RouterLink",{attrs:{to:"/guide/user-guide/code-repo.html#删除代码库api"}},[t._v("删除代码库")]),t._v("、"),a("RouterLink",{attrs:{to:"/guide/user-guide/project.html#删除项目api"}},[t._v("删除项目")]),t._v("、"),a("RouterLink",{attrs:{to:"/guide/user-guide/product.html#删除产品api"}},[t._v("删除产品")]),t._v("等 API 接口。")],1)]),t._v(" "),a("h3",{attrs:{id:"生成删除物理集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成删除物理集群的-api-请求"}},[t._v("#")]),t._v(" 生成删除物理集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_DeleteCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://$api-server-address/api/v1/clusters/$cluster-name'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer $gitlab-access-token'")]),t._v("\n")])])]),a("p",[t._v("替换变量后的请求示例如下：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/physical-worker-deployment'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),t._v("\n")])])]),a("h3",{attrs:{id:"执行删除物理集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行删除物理集群的-api-请求"}},[t._v("#")]),t._v(" 执行删除物理集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求。")]),t._v(" "),a("p",[t._v("请求成功后，将删除物理集群，以及在租户配置库的集群资源文件。")]),t._v(" "),a("blockquote",[a("p",[t._v("只有当您的账号是租户配置库的成员，并且具备 main 分支的写入权限，才可以删除运行时集群。")])]),t._v(" "),a("h2",{attrs:{id:"删除虚拟集群-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#删除虚拟集群-api"}},[t._v("#")]),t._v(" 删除虚拟集群（API）")]),t._v(" "),a("blockquote",[a("p",[t._v("请确保已成功注册虚拟集群。")]),t._v(" "),a("p",[t._v("在删除集群之前请先删除产品配置清单。")])]),t._v(" "),a("h3",{attrs:{id:"生成删除虚拟集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成删除虚拟集群的-api-请求"}},[t._v("#")]),t._v(" 生成删除虚拟集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_DeleteCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。API请求示例与"),a("a",{attrs:{href:"#%E5%88%A0%E9%99%A4%E7%89%A9%E7%90%86%E9%9B%86%E7%BE%A4api"}},[t._v("删除物理集群")]),t._v("类似：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/virtual-worker-pipeline'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),t._v("\n")])])]),a("h3",{attrs:{id:"执行删除虚拟集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行删除虚拟集群的-api-请求"}},[t._v("#")]),t._v(" 执行删除虚拟集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求。\n请求成功后，将删除虚拟集群，以及在租户配置库中的集群资源文件。")]),t._v(" "),a("h3",{attrs:{id:"生成删除宿主集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#生成删除宿主集群的-api-请求"}},[t._v("#")]),t._v(" 生成删除宿主集群的 API 请求")]),t._v(" "),a("p",[t._v("通过接口定义 "),a("code",[t._v("Cluster_DeleteCluster")]),t._v(" 生成 API 请求示例，并添加 access token 作为请求头。API请求示例与"),a("a",{attrs:{href:"#%E5%88%A0%E9%99%A4%E7%89%A9%E7%90%86%E9%9B%86%E7%BE%A4api"}},[t._v("删除物理集群")]),t._v("类似：")]),t._v(" "),a("div",{staticClass:"language-Shell extra-class"},[a("pre",{pre:!0,attrs:{class:"language-shell"}},[a("code",[t._v("    "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("curl")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-X")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'DELETE'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'HTTP://xxx.xxx.xxx.xxx:xxxxx/api/v1/clusters/cluster-host'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'accept: application/json'")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-H")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Authorization: Bearer xxxxxxxxxxxxxxxxxxxx'")]),t._v("\n")])])]),a("h3",{attrs:{id:"执行删除宿主集群的-api-请求"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#执行删除宿主集群的-api-请求"}},[t._v("#")]),t._v(" 执行删除宿主集群的 API 请求")]),t._v(" "),a("p",[t._v("使用 curl 命令或者其他工具执行 API 请求。")]),t._v(" "),a("p",[t._v("请求成功后，将删除宿主集群，以及在租户配置库中的集群资源文件。")]),t._v(" "),a("blockquote",[a("p",[t._v("只有当您的账号是租户配置库的成员，并且具备 main 分支的写入权限，才可以删除运行时集群。")])])])}),[],!1,null,null,null);a.default=n.exports}}]);