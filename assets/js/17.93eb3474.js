(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{290:function(a,t,s){"use strict";s.r(t);var e=s(14),r=Object(e.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"安装部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#安装部署"}},[a._v("#")]),a._v(" 安装部署")]),a._v(" "),t("p",[a._v("Nautes 支持基于公有云、私有云、主机、及 Kubernets 集群进行部署，下文以阿里云为例描述在公有云部署 Nautes 的过程。")]),a._v(" "),t("h2",{attrs:{id:"准备环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#准备环境"}},[a._v("#")]),a._v(" 准备环境")]),a._v(" "),t("ul",[t("li",[a._v("部署机：AMD64 架构的 Linux 服务器，需要预先安装 Docker、Git、Bash，并确保 /opt/nautes 目录没有被占用。")]),a._v(" "),t("li",[a._v("公有云密钥：一个阿里云账号的访问密钥，如果您使用的是 RAM 用户，请确保 RAM 用户有 AliyunECSFullAccess 和 AliyunVPCFullAccess 权限。详情参考 "),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/116401.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("创建 AccessKey"),t("OutboundLink")],1),a._v("。")])]),a._v(" "),t("blockquote",[t("p",[a._v("部署程序会调用阿里云的 API 申请资源，这个过程会产生一定的费用（请参考"),t("a",{attrs:{href:"#aliyun-cost"}},[a._v("阿里云费用说明")]),a._v("）。")]),a._v(" "),t("p",[a._v("受阿里云的计费规则限制，请确保上述阿里云账号内的余额大于100元人民币，否则部署程序无法调用阿里云的 API 申请资源。")])]),a._v(" "),t("h2",{attrs:{id:"执行部署"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#执行部署"}},[a._v("#")]),a._v(" 执行部署")]),a._v(" "),t("ol",[t("li",[a._v("在部署机上克隆部署程序的项目：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/nautes-labs/installer.git\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("根据 vars.yaml.sample 编写 vars.yaml，其中 access_key 和 secret_key 必须填写为阿里云账号的 AccessKey，其他配置可采用默认值。")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOT"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">>")]),a._v(" vars.yaml")]),a._v("\naccess_key: < your alicloud access key >\nsecret_key: < your alicloud secret key >\nEOT")]),a._v("\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("执行 "),t("code",[a._v("start.sh")]),a._v(" 脚本开始部署：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" start.sh\n")])])]),t("blockquote",[t("p",[a._v("由于需要部署的组件较多，整个部署过程预计耗时40~50分钟，部署成功后，您可以在在 /opt/nautes 目录下找到部署后的组件信息。如果部署失败，您可以通过 /opt/nautes/out/logs 目录下的日志排查问题。")])]),a._v(" "),t("h2",{attrs:{id:"查看部署结果"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查看部署结果"}},[a._v("#")]),a._v(" 查看部署结果")]),a._v(" "),t("p",[a._v("/opt/nautes/management 是租户配置库的本地副本。")]),a._v(" "),t("p",[a._v("/opt/nautes/terraform 是 terraform 的状态文件，记录了部署程序在阿里云上申请的资源清单。")]),a._v(" "),t("p",[a._v("/opt/nautes 中存储了已部署组件的相关信息，包含多个子目录：")]),a._v(" "),t("ul",[t("li",[a._v("argocd：ArgoCD 的管理员密码。")]),a._v(" "),t("li",[a._v("gitlab：GitLab 的管理员密码，以及部署过程中所生成的租户配置库、访问密钥等信息。")]),a._v(" "),t("li",[a._v("hosts：云服务器的 IP 地址和访问密钥。")]),a._v(" "),t("li",[a._v("kubernetes：租户管理集群的 kubeconfig，以及 dex 的客户端密钥。")]),a._v(" "),t("li",[a._v("pki：访问组件需要使用的证书和签发证书的 CA。")]),a._v(" "),t("li",[a._v("vault：Vault 的 unseal key 和 root token。")]),a._v(" "),t("li",[a._v("service：租户管理集群、Dex、ArgoCD、Vault、GitLab、Nautes API Server 的访问地址。")]),a._v(" "),t("li",[a._v("logs：部署程序的日志")])]),a._v(" "),t("h2",{attrs:{id:"销毁环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#销毁环境"}},[a._v("#")]),a._v(" 销毁环境")]),a._v(" "),t("blockquote",[t("p",[a._v("请确保已成功执行部署，未删除部署机上的 /opt/nautes 目录，且 nautes-installer 容器在运行中。")]),a._v(" "),t("p",[a._v("销毁程序将删除所有从云服务中申请的资源，暂不支持单独对组件执行卸载。")])]),a._v(" "),t("ol",[t("li",[a._v("在部署机上克隆安装程序的项目：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("git")]),a._v(" clone https://github.com/nautes-labs/installer.git\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("修改项目根目录下的 vars.yaml 文件，填写 access_key 和 secret_key。")]),a._v(" "),t("li",[a._v("执行 "),t("code",[a._v("destroy.sh")]),a._v(" 脚本开始销毁环境：")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[a._v("sh")]),a._v(" destroy.sh\n")])])]),t("h2",{attrs:{id:"阿里云费用说明-aliyun-cost"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#阿里云费用说明-aliyun-cost"}},[a._v("#")]),a._v(" 阿里云费用说明 {#aliyun-cost}")]),a._v(" "),t("p",[a._v("部署程序所申请的云服务器的默认规格如下：")]),a._v(" "),t("ul",[t("li",[a._v("区域：中国香港-可用区B")]),a._v(" "),t("li",[a._v("镜像：Ubuntu 22.04 64位")]),a._v(" "),t("li",[a._v("实例规格：ecs.c6.large(2C4G)")]),a._v(" "),t("li",[a._v("系统盘：ESSD云盘 PL0 40G")]),a._v(" "),t("li",[a._v("网络：实例公网IP")])]),a._v(" "),t("p",[a._v("部署程序默认使用"),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/52088.html?spm=5176.ecsbuyv3.0.0.2a2736756P0dh1",target:"_blank",rel:"noopener noreferrer"}},[a._v("抢占式实例模式"),t("OutboundLink")],1),a._v("创建云服务器，该模式存在实例被自动释放的风险。如果您希望体验更稳定的环境，请在 vars.yaml 增加以下配置，让部署程序切换至"),t("a",{attrs:{href:"https://help.aliyun.com/document_detail/40653.html?spm=5176.ecsbuyv3.0.0.2a2736756P0dh1",target:"_blank",rel:"noopener noreferrer"}},[a._v("按量付费模式"),t("OutboundLink")],1),a._v("申请资源。")]),a._v(" "),t("div",{staticClass:"language-yaml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-yaml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("alicloud")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token key atrule"}},[a._v("save_money")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token boolean important"}},[a._v("false")]),a._v("\n")])])]),t("p",[a._v("两种付费模式的费用预估如下（不包含流量费）：")]),a._v(" "),t("ul",[t("li",[t("p",[a._v("按量付费：88.32￥/天")])]),a._v(" "),t("li",[t("p",[a._v("抢占式实例：24￥/天")])])]),a._v(" "),t("blockquote",[t("p",[a._v("实际产生的费用会受到市场价格波动的影响，以上预估值仅供参考")])])])}),[],!1,null,null,null);t.default=r.exports}}]);